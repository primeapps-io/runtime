"use strict";angular.module("primeapps").factory("genericInterceptor",["$q","$injector","$window","$localStorage","$filter","ngToast","$cookies","$rootScope",function(e,r,t,a,n,o,s,c){return{request:function(e){e.headers=e.headers||{};var r=a.read("access_token");cdnUrl&&e.url.indexOf(cdnUrl)>-1||blobUrl&&e.url.indexOf(blobUrl)>-1||routeTemplateUrls&&e.url.indexOf(routeTemplateUrls)>-1?e.headers["Access-Control-Allow-Origin"]="*":r&&e.url.indexOf("/token")<0&&(""===blobUrl||e.url.indexOf(blobUrl)<0)&&(""===routeTemplateUrls||e.url.indexOf(routeTemplateUrls)<0)&&(e.headers.Authorization="Bearer "+r),c.branchAvailable&&(e.headers.branch_id=c.user.branchId);var t=s.get("app_id"),n=s.get("tenant_id");if(t&&(e.headers["X-App-Id"]=t),n&&(e.headers["X-Tenant-Id"]=n),trustedUrls.length>0){var o=function(e){switch(e){case"X-User-Id":case"x-user-id":case"user_id":return c.user.id;case"X-Tenant-Id":case"x-tenant-id":case"tenant_id":return c.user.tenant_id;case"X-App-Id":case"x-app-id":case"app_id":return t;case"X-Auth-Key":case"x-auth-key":return encryptedUserId;case"X-Branch-Id":case"x-branch-id":case"branch_id":return c.branchAvailable?c.user.branchId:""}};angular.forEach(trustedUrls,function(r){e.url.indexOf(r.url)>-1&&(r.headers&&angular.forEach(r.headers,function(r,t){e.headers[t]=r.indexOf("::dynamic")>-1?o(t):r}),e.headers["Access-Control-Allow-Origin"]="*")})}return e},responseError:function(r){return 401===r.status?r.config.url.indexOf("/token")>-1?e.reject(r):void("Unauthorized"===r.statusText?(a.remove("access_token"),a.remove("refresh_token"),t.location.href="/logout"):t.location.href="/"):500===r.status&&r.config.url.indexOf("/User/MyAccount")>-1?(a.remove("access_token"),a.remove("refresh_token"),t.location.href="/logout",e.reject(r)):402===r.status?(t.location.href="#/paymentform",e.reject(r)):403===r.status?(t.location.href="#/app/dashboard",o.create({content:n("translate")("Common.Forbidden"),className:"danger"}),e.reject(r)):404===r.status?(r.config.ignoreNotFound||(t.location.href="#/app/dashboard",o.create({content:n("translate")(r.config.url.indexOf("/module")>-1?"Common.NotFoundRecord":"Common.NotFound"),className:"warning"})),e.reject(r)):navigator.onLine&&421!==r.status&&429!==r.status?400===r.status||409===r.status?e.reject(r):(o.create({content:n("translate")("Common.Error"),className:"danger"}),e.reject(r)):(o.create({content:n("translate")("Common.NetworkError"),className:"warning"}),e.reject(r))}}}]);