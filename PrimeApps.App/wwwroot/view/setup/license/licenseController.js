"use strict";angular.module("primeapps").controller("LicenseController",["$rootScope","$scope","$filter","$popover","$state","ngToast","config","LicenseService","WorkgroupService","AuthService","PaymentService",function(e,n,o,t,c,a,r,i,d,s,u){function l(){n.licensePrice=45,n.addonPrice=45,n.addonStoragePrice=10,"USD"===e.user.currency&&(n.licensePrice=10,n.addonPrice=10,n.addonStoragePrice=4),12===n.licenseInfo.CurrentPaymentFrequency&&(n.licensePrice=37.5,n.addonPrice=37.5,n.addonStoragePrice=10,"USD"===e.user.currency&&(n.licensePrice=8.5,n.addonPrice=8.5,n.addonStoragePrice=4))}function p(){var t=o("msDate")(e.licenseStatus.NextInvoiceDate);t=o("date")(t,"dd MMMM yyyy"),n.notAllowedParams={date:t};var c=o("msDate")(n.licenseInfo.AvailableLicenses[0].NextPaymentDate);c=o("date")(c,"dd MMMM yyyy");var a=29.5,r=294;"USD"===e.user.currency&&(a=11.5,r=114);var i=1===n.licenseInfo.CurrentPaymentFrequency?r:a,d=o("translate")(1===n.licenseInfo.CurrentPaymentFrequency?"Setup.License.LicenseTypeAnnual":"Setup.License.LicenseTypeMountly");n.changeParams={date:c,price:i,currency:e.user.currency.toLowerCase(),period:d.toLowerCase()}}n.loading=!0,i.getLicense().then(function(e){n.licenseInfo=e.data,n.loading=!1,l()}),u.getPayment().then(function(e){n.payment=e.data}),n.showChangePopover=function(){p(),n.changePopover=n.changePopover||t(angular.element(document.getElementById("changeButton")),{templateUrl:"view/setup/license/licenseChange.html",placement:"right",scope:n,show:!0})},n.change=function(){n.licenseChanging=!0;var t=e.licenseStatus.License.id,c=1===n.licenseInfo.CurrentPaymentFrequency?12:1;i.change(t,c).then(function(){i.getLicenseStatus().then(function(t){e.licenseStatus=t.data,i.getLicense().then(function(e){n.licenseInfo=e.data,p(),l(),n.changePopover.hide(),n.licenseChanging=!1,a.create({content:o("translate")("Setup.License.ChangeSuccess"),className:"success"})})["catch"](function(){n.changePopover.hide(),n.licenseChanging=!1})})["catch"](function(){n.changePopover.hide(),n.licenseChanging=!1})})["catch"](function(){n.changePopover.hide(),n.licenseChanging=!1})},n.showAddonPopover=function(){p(),n.addonPopover=n.addonPopover||t(angular.element(document.getElementById("addAddonButton")),{templateUrl:"view/setup/license/licenseAddon.html",placement:"right",scope:n,show:!0})},n.gotoPaymentInfo=function(){var e=o("filter")(n.$parent.menuItems,{link:"#/app/setup/payment"})[0];n.$parent.selectMenuItem(e),c.go("app.setup.payment")},n.addonModel={},n.addonModel.user=0,n.addonModel.disk=0,n.addAddon=function(){n.addonAdding=!0;var t=n.addonModel;i.addAddonLicense(t.user,t.disk).then(function(){i.getLicenseStatus().then(function(t){e.licenseStatus=t.data,i.getLicense().then(function(e){n.licenseInfo=e.data,p(),n.addonModel.user=0,n.addonModel.disk=0,n.addonAdding=!1,a.create({content:o("translate")("Setup.License.AddonSuccess"),className:"success"}),n.addonPopover.hide()})["catch"](function(){n.addonPopover.hide(),n.addonAdding=!1})})["catch"](function(){n.addonPopover.hide(),n.addonAdding=!1})})["catch"](function(){n.addonPopover.hide(),n.addonAdding=!1})},n.showRemovePopover=function(e){n.removeType=e,"user"===e?(n.removePopoverUser=n.removePopoverUser||t(angular.element(document.getElementById("removeButtonUser")),{templateUrl:"view/setup/license/licenseRemove.html",placement:"left",scope:n,show:!0}),n.removePopoverStorage&&n.removePopoverStorage.hide()):(n.removePopoverStorage=n.removePopoverStorage||t(angular.element(document.getElementById("removeButtonStorage")),{templateUrl:"view/setup/license/licenseRemove.html",placement:"left",scope:n,show:!0}),n.removePopoverUser&&n.removePopoverUser.hide())},n.removeAddon=function(){n.addonRemoving=!0,i.removeAddonLicense(n.removeType).then(function(){i.getLicenseStatus().then(function(t){e.licenseStatus=t.data,i.getLicense().then(function(e){n.licenseInfo=e.data,p(),n.addonRemoving=!1,a.create({content:o("translate")("Setup.License.RemoveSuccess"),className:"success"}),n.removePopoverUser&&n.removePopoverUser.hide(),n.removePopoverStorage&&n.removePopoverStorage.hide()})["catch"](function(){n.removePopoverUser.hide(),n.removePopoverStorage.hide(),n.addonRemoving=!1})})["catch"](function(){n.removePopoverUser.hide(),n.removePopoverStorage.hide(),n.addonRemoving=!1})})["catch"](function(){n.removePopoverUser.hide(),n.removePopoverStorage.hide(),n.addonRemoving=!1})},n.upgrade=function(){n.upgrading=!0,d.upgradeLicense(r.planIdMembers,1).then(function(){s.logout().then(function(){s.logoutComplete(),a.create({content:o("translate")("Join.JoinSuccess"),className:"success",timeout:8e3})})["catch"](function(){n.upgrading=!1})})["catch"](function(){n.upgrading=!1})}}]);