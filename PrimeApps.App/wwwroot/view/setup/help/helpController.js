"use strict";angular.module("primeapps").controller("HelpController",["$rootScope","$scope","HelpService","ngToast","$filter","$window","$modal","config","$localStorage","$location","$cache","$state","$cookies",function(e,t,l,a,i,n,o,p,s,d,m,u,r){t.moduleFilter=i("filter")(e.modules,{deleted:!1}),t.selectHelp="modules",t.selectHelpRelation="any",t.isTimetrackerExist=!1,t.$parent.collapsed=!0,t.id=d.search().id;var c;c=t.id?window.location.hash.split("/")[3].split("?")[0]:window.location.hash.split("/")[3],t.helpEnums=[{Id:1,Name:"module_list",Label:i("translate")("Setup.HelpGuide.List")},{Id:2,Name:"module_detail",Label:i("translate")("Setup.HelpGuide.Detail")},{Id:3,Name:"module_form",Label:i("translate")("Setup.HelpGuide.Form")}],t.routeModule=[{name:i("translate")("Setup.HelpGuide.FirstScreen"),value:"firstscreen"},{name:i("translate")("Setup.HelpGuide.Dashboard"),value:"/app/dashboard"},{name:i("translate")("Setup.HelpGuide.Newsfeed"),value:"/app/newsfeed"},{name:i("translate")("Setup.HelpGuide.Report"),value:"/app/reports"},{name:i("translate")("Setup.HelpGuide.Tasks"),value:"/app/tasks"},{name:i("translate")("Setup.HelpGuide.Calendar"),value:"/app/calendar"}],t.routeModuleSide=[{name:i("translate")("Setup.HelpGuide.Dashboard"),value:"/app/dashboard"},{name:i("translate")("Setup.HelpGuide.Newsfeed"),value:"/app/newsfeed"},{name:i("translate")("Setup.HelpGuide.Report"),value:"/app/reports"},{name:i("translate")("Setup.HelpGuide.Tasks"),value:"/app/tasks"},{name:i("translate")("Setup.HelpGuide.Calendar"),value:"/app/calendar"},{name:i("translate")("Setup.Nav.PersonalSettings"),value:"/app/setup/settings"},{name:i("translate")("Setup.Nav.Users"),value:"/app/setup/users"},{name:i("translate")("Setup.Nav.OrganizationSettings"),value:"/app/setup/organization"},{name:i("translate")("Setup.Nav.Customization"),value:"/app/setup/modules"},{name:i("translate")("Setup.Nav.Data"),value:"/app/setup/importhistory"},{name:i("translate")("Setup.Nav.System"),value:"/app/setup/general"},{name:i("translate")("Setup.Nav.Workflow"),value:"/app/setup/workflows"},{name:i("translate")("Setup.Nav.ApprovelProcess"),value:"/app/setup/approvel_process"}];var h,f,_=plupload.guid();t.imgUpload={settings:{multi_selection:!1,url:p.apiUrl+"Document/upload_attachment",headers:{Authorization:"Bearer "+s.read("access_token"),Accept:"application/json","X-Tenant-Id":r.get("tenant_id")},multipart_params:{container:_},filters:{mime_types:[{title:"Image files",extensions:"jpg,gif,png"}],max_file_size:"2mb"},resize:{quality:90}},events:{filesAdded:function(e){e.start(),tinymce.activeEditor.windowManager.open({title:i("translate")("Common.PleaseWait"),width:50,height:50,body:[{type:"container",name:"container",label:"",html:"<span>"+i("translate")("EMail.UploadingAttachment")+"</span>"}],buttons:[]})},uploadProgress:function(){},fileUploaded:function(e,t,l){tinymce.activeEditor.windowManager.close();var a=JSON.parse(l.response);h(a.public_url,{alt:t.name}),h=null},error:function(e,t){switch(t.code){case-600:tinymce.activeEditor.windowManager.alert(i("translate")("EMail.MaxImageSizeExceeded"))}f&&(f(),f=null)}}};var y=function(){var e=[];return l.getCustomHelp("sidemodal",!1).then(function(l){if(l.data&&0!=l.data.length){t.helpTemplatesToolbar=l.data;for(var a=0;a<l.data.length;a++)e[a]={text:t.helpTemplatesToolbar[a].name,id:t.helpTemplatesToolbar[a].id,onclick:function(){tinymce.activeEditor.execCommand("mceInsertContent",!1,'<a href="#" style="cursor: pointer" onclick="angular.element(document).scope().openHelp('+this.settings.id+');return false">'+this.settings.text+"</a>")}};e.unshift({text:"Tümü",id:0,onclick:function(){for(var e=0;e<l.data.length;e++)tinymce.activeEditor.execCommand("mceInsertContent",!1,'<a href="#" style="cursor: pointer;display: block" onclick="angular.element(document).scope().openHelp('+t.helpTemplatesToolbar[e].id+');return false">'+t.helpTemplatesToolbar[e].name+"</a>")}})}}),e};t.iframeElement={},t.tinymceOptions={setup:function(e){e.on("init",function(){t.loadingModal=!1})},onChange:function(){},inline:!1,height:300,language:e.language,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools textcolor colorpicker"],imagetools_cors_hosts:["crm.ofisim.com","test.ofisim.com","ofisimcomdev.blob.core.windows.net"],toolbar:"insertfile undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media imagetools | code preview fullscreen",menubar:"false",templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}],skin:"lightgray",resize:!1,theme:"modern",branding:!1,valid_elements:"*[*]",file_picker_callback:function(e,t,l){if(h=e,"file"==l.filetype){var a=document.getElementById("uploadFile");a.click()}if("image"==l.filetype){var a=document.getElementById("uploadImage");a.click()}},image_advtab:!0,file_browser_callback_types:"image file",paste_data_images:!0,spellchecker_language:e.language,images_upload_handler:function(e,l,a){var i=e.blob();h=l,f=a,t.imgUpload.uploader.addFile(i)},convert_urls:!1,remove_script_host:!1},t.tinymceOptionsSide={setup:function(e){e.addButton("helpTemplate",{type:"menubutton",text:i("translate")("Yardımlar"),icon:!1,menu:y()}),e.on("init",function(){t.loadingModal=!1})},onChange:function(){},inline:!1,height:800,language:e.language,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste imagetools textcolor colorpicker"],imagetools_cors_hosts:["crm.ofisim.com","test.ofisim.com","ofisimcomdev.blob.core.windows.net"],toolbar:"insertfile undo redo | helpTemplate | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media imagetools | code preview fullscreen",menubar:"false",templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}],skin:"lightgray",resize:!1,theme:"modern",branding:!1,valid_elements:"*[*]",file_picker_callback:function(e,t,l){if(h=e,"file"==l.filetype){var a=document.getElementById("uploadFile");a.click()}if("image"==l.filetype){var a=document.getElementById("uploadImage");a.click()}},image_advtab:!0,file_browser_callback_types:"image file",paste_data_images:!0,spellchecker_language:e.language,images_upload_handler:function(e,l,a){var i=e.blob();h=l,f=a,t.imgUpload.uploader.addFile(i)},convert_urls:!1,remove_script_host:!1},i("filter")(e.modules,{name:"timetrackers"},!0).length>0&&(t.isTimetrackerExist=!0),t.isTimetrackerExist&&(t.routeModule.push({name:i("translate")("Timetracker.Timetracker"),value:"/app/timetracker"}),t.routeModuleSide.push({name:i("translate")("Timetracker.Timetracker"),value:"/app/timetracker"})),t.modalType="helpside"===c?"sidemodal":"modal",t.id&&(t.editDisable=!0,l.getById(t.id).then(function(e){if(t.helpTemplatesSide=e.data,!t.helpTemplatesSide||t.helpTemplatesSide.module_id||t.helpTemplatesSide.route_url)if(t.helpTemplatesSide&&t.helpTemplatesSide.module_id)if(t.selectHelpRelation="module","module_list"==t.helpTemplatesSide.module_type){t.selectHelp="list",t.helpName=t.helpTemplatesSide.name,t.tinymceModel=t.helpTemplatesSide.template;var l=i("filter")(t.moduleFilter,{id:t.helpTemplatesSide.module_id})[0];t.modulePicklist=l}else if("module_detail"==t.helpTemplatesSide.module_type){t.selectHelp="detail",t.helpName=t.helpTemplatesSide.name,t.tinymceModel=t.helpTemplatesSide.template;var a=i("filter")(t.moduleFilter,{id:t.helpTemplatesSide.module_id})[0];t.moduleDetail=a}else{t.selectHelp="form",t.helpName=t.helpTemplatesSide.name,t.tinymceModel=t.helpTemplatesSide.template;var n=i("filter")(t.moduleFilter,{id:t.helpTemplatesSide.module_id})[0];t.moduleForm=n}else{t.selectHelpRelation="other",t.helpName=t.helpTemplatesSide.name,t.tinymceModel=t.helpTemplatesSide.template;var o=i("filter")(t.routeModuleSide,{value:t.helpTemplatesSide.route_url})[0];t.routeModules=o}else t.helpName=t.helpTemplatesSide.name,t.tinymceModel=t.helpTemplatesSide.template})),t.setContent=function(){t.modulePicklist?l.getModuleType(t.modalType,"modulelist",t.modulePicklist.id).then(function(e){t.helpTemplates=e.data,t.helpTemplates?(t.helpName=t.helpTemplates.name,t.tinymceModel=t.helpTemplates.template,t.currentTemplate=t.helpTemplates):(t.tinymceModel=null,t.currentTemplate=null)}):(t.helpName=null,t.tinymceModel=null,t.currentTemplate=null)},t.setContentSettingsModul=function(){t.routeModules?l.getByType(t.modalType,null,t.routeModules.value).then(function(e){t.helpTemplates=e.data,t.helpTemplates?(t.tinymceModel=t.helpTemplates.template,t.currentTemplate=t.helpTemplates):(t.tinymceModel=null,t.currentTemplate=null)}):(t.tinymceModel=null,t.currentTemplate=null)},t.radioButtonTemplateClear=function(){"modules"===t.selectHelp?t.setContent():t.setContentSettingsModul()},t.helpModalSave=function(){var e={};if("modules"===t.selectHelp){var e={};e.module_id=t.modulePicklist.id,e.route_url=null,e.first_screen=!1,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=1,e.module_type=1,e.name="modal"}else{var e={};e.module_id=null,e.route_url=t.routeModules.value,"firstscreen"===t.routeModules.value&&(e.first_screen=!0),e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=1,e.module_type=1,e.name="modal"}t.currentTemplate||t.id?(e.id=t.helpTemplates.id,l.update(e),m.removeAll(),a.create({content:i("translate")("Setup.HelpGuide.HelPTemplateUpdate"),className:"success"})):l.create(e).then(function(){l.getByType(t.modalType).then(function(e){t.helpTemplates=e.data,a.create({content:i("translate")("Setup.HelpGuide.HelPTemplatePublish"),className:"success"})})})},t.helpModalDraftSave=function(){var e={};e.module_id=t.modulePicklist.id,e.route_url=null,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=2,e.module_type=1,e.name=t.modulePicklist.label_tr_singular,t.currentTemplate||t.id?(e.id=t.id?t.id:t.helpTemplates.id,l.update(e),m.removeAll(),a.create({content:i("translate")("Setup.HelpGuide.HelPTemplateDraftUpdate"),className:"success"})):l.create(e).then(function(){l.getByType(t.modalType).then(function(e){t.helpTemplates=e.data,m.removeAll(),a.create({content:i("translate")("Setup.HelpGuide.HelPTemplateDraftSave"),className:"success"})})})},t.helpSideSave=function(){var e={};"any"===t.selectHelpRelation?(e.module_id=null,e.route_url=null,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=1,e.module_type=1,e.name=t.helpName):"list"===t.selectHelp?(e.module_id=t.modulePicklist.id,e.route_url=null,e.first_screen=!1,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=1,e.module_type=1,e.name=t.helpName):"detail"===t.selectHelp?(e.module_id=t.moduleDetail.id,e.route_url=null,e.first_screen=!1,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=1,e.module_type=2,e.name=t.helpName):"form"===t.selectHelp?(e.module_id=t.moduleForm.id,e.route_url=null,e.first_screen=!1,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=1,e.module_type=3,e.name=t.helpName):"other"===t.selectHelpRelation&&(e.module_id=null,e.route_url=t.routeModules.value,e.first_screen=!1,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=1,e.module_type=1,e.name=t.helpName),t.currentTemplate||t.id?(e.id=t.id?t.id:t.helpTemplates.id,l.update(e),m.removeAll(),u.go("app.setup.helpsides"),a.create({content:i("translate")("Setup.HelpGuide.HelPTemplateUpdate"),className:"success"})):(t.moduleControl=!1,angular.forEach(t.helpsides,function(l){var a=i("filter")(t.helpEnums,{Name:l.module_type})[0];l.module_id===e.module_id&&a.id===e.module_type&&(t.moduleControl=!0)}),t.moduleControl?a.create({content:i("translate")("Setup.HelpGuide.SomeModuleNotAvailable"),className:"warning"}):l.create(e).then(function(){l.getByType(t.modalType).then(function(e){t.helpTemplates=e.data,y(),u.go("app.setup.helpsides"),a.create({content:i("translate")("Setup.HelpGuide.HelPTemplatePublish"),className:"success"})})}))},t.helpSideDraftSave=function(){var e={};"any"===t.selectHelpRelation?(e.module_id=null,e.route_url=null,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=2,e.module_type=1,e.name=t.helpName):"list"===t.selectHelp?(e.module_id=t.modulePicklist.id,e.route_url=null,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=2,e.module_type=1,e.name=t.helpName):"detail"===t.selectHelp?(e.module_id=t.moduleDetail.id,e.route_url=null,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=2,e.module_type=2,e.name=t.helpName):"form"===t.selectHelp?(e.module_id=t.moduleForm.id,e.route_url=null,e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=2,e.module_type=3,e.name=t.helpName):"other"===t.selectHelpRelation&&(e.module_id=null,e.route_url=t.routeModules.value,"firstscreen"===t.routeModules.value&&(e.first_screen=!0),e.template=t.tinymceModel,e.modal_type="helpside"===c?2:1,e.show_type=2,e.module_type=1,e.name=t.helpName),t.currentTemplate||t.id?(e.id=t.id?t.id:t.helpTemplates.id,l.update(e),m.removeAll(),u.go("app.setup.helpsides"),a.create({content:i("translate")("Setup.HelpGuide.HelPTemplateDraftUpdate"),className:"success"})):l.create(e).then(function(){l.getByType(t.modalType).then(function(e){t.helpTemplates=e.data,u.go("app.setup.helpsides"),a.create({content:i("translate")("Setup.HelpGuide.HelPTemplateDraftSave"),className:"success"})})})},t.templateDelete=function(){var e;e=t.helpTemplates,l["delete"](e.id).then(function(){l.getModuleType(t.modalType,"modulelist",t.modulePicklist.id).then(function(e){t.helpTemplates=e.data,t.tinymceModel=null}),a.create({content:i("translate")("Template.SuccessDelete"),className:"success"})})};var g=function(){l.getAll("sidemodal").then(function(e){t.helpsides=l.process(e.data,t.moduleFilter,t.routeModuleSide,t.helpEnums),t.loading=!1})};g(),t["delete"]=function(e){l["delete"](e).then(function(){g()})}}]);