"use strict";angular.module("primeapps").controller("ModuleListController",["$rootScope","$scope","$sce","$filter","helper","$location","$state","$stateParams","$q","$window","$localStorage","$cache","config","exportFile","operations","ModuleService","$http","components","HelpService","mdToast","$mdDialog","customScripting","$timeout","$mdMedia","blockUI",function(e,t,a,i,r,l,o,n,s,d,u,c,p,g,m,f,v,w,y,h,b,_,k,V,S){function F(e,a,r){for(var l=t.freezeFields||[],o=0;o<e.length;o++){var n=e[o],s=i("filter")(t.module.fields,{name:n.parent_field,deleted:!1},!0)[0];s&&r?l.push(s):s&&B(a,n,s)}return r?l:void 0}function B(e,a,i){for(var r=0;r<e.length;r++)if(!e[r].freeze){var l=f.processRecordSingle(angular.copy(e[r]),t.module,t.modulePicklists),o=!1;if(1===l.process_status)return;if(a.values_array&&a.values_array.length>0)for(var n=0;n<a.values_array.length;n++){var s=parseInt(a.values_array[n]);!l[i.name]||s!==l[i.name]&&s!==l[i.name].id||(o=!0)}else"Yes"===l[i.name]&&(o=!0);e[r].freeze=o}}function D(){return i("filter")(t.module.dependencies,{dependency_type:"freeze",deleted:!1},!0)}function R(e){if(null!=e.group&&null!=e.group.filters&&e.group.filters.length>0)for(var a="",r=i("filter")(e.group.filters,function(e){return e.key},!0),l=0;l<e.group.filters.length;l++){var o=e.group.filters[l];if(null!=o.group){var n=R(o);n&&!n.contains("undefined")&&(a+=(1!==o.group.level&&0!==l?" "+t.filtera.group.logic+" ":"")+n)}else if(null!=o.operator&&""!==o.operator){if(z++,o=t.processViewFilter(o,z),!o)continue;Y.push(o),1===e.group.level&&0===l&&l!==r.length-1&&(a+="("),a+=(0===l?"":" "+e.group.logic+" ")+Y.length,1===e.group.level&&l===r.length-1&&0!==l&&(a+=")")}}return a&&!a.contains("undefined")&&(a="("+a+")"),a}function x(){t.viewChangeStatus||(t.viewChangeStatus=!0)}function T(){if(Array.isArray(e.activeView.filters)){for(var a=0;a<e.activeView.filters.length;a++){const r=e.activeView.filters[a];if(r){var l=i("filter")(t.viewFields.selectedFields,{name:r.field},!0)[0];l||(r.field.split(".").length>1?t.findRequest.fields.push(r.field):t.selectedFieldsAll&&(l=i("filter")(t.selectedFieldsAll,{name:r.field},!0)[0],l&&"lookup"===l.data_type&&t.findRequest.fields.push(l.name)))}}t.findRequest.fields=t.findRequest.fields.getUnique()}}function M(){if(t.findRequest&&t.findRequest.fields){const e=i("filter")(t.module.fields,{primary:!0},!0)[0];if(e){const a=t.findRequest.fields.indexOf(e.name);0>a&&t.findRequest.fields.push(e.name)}}}function L(e,a){if(null!=e.group&&null!=e.group.filters&&e.group.filters.length>0)for(var r=0;r<e.group.filters.length;r++){var l=e.group.filters[r];null!=l.group?L(l,a):a?(angular.isObject(l.field)||(l.field=i("filter")(t.module.fields,{deleted:!1,name:l.field},!0)[0]),l.field&&!angular.isObject(l.operator)&&(l.operator=i("filter")(l.field.operators,{name:l.operator},!0)[0]),l.field&&"picklist"===l.field.data_type&&angular.isObject(l.value)?l.value=l.value.id.toString():!l.field||"checkbox"!==l.field.data_type||l.value!==!0&&l.value!==!1||(l.value={value:l.value})):(l.field=l.field&&angular.isObject(l.field)?l.field.name:"",l.operator=l.operator&&angular.isObject(l.operator)?l.operator.name:"")}}function P(t){if(t.filters)for(var a=0;a<t.filters.length;a++){var i=t.filters[a];"[me]"==i.value&&(i.value=e.user.id)}}t.type=n.type,t.operations=m,t.hasPermission=r.hasPermission,t.loading=!0,t.module=t.modulus[t.type],t.lookupUser=r.lookupUser,t.lookupProfile=r.lookupProfile,t.lookupRole=r.lookupRole,t.searchingDocuments=!1,t.isAdmin=e.user.profile.has_admin_rights,t.hasActionButtonDisplayPermission=f.hasActionButtonDisplayPermission,t.hideDeleteAll=i("filter")(e.deleteAllHiddenModules,t.type+"|"+t.type,!0)[0],t.actionButtonDisabled=!1,t.showExportButton=!0,t.hasViewPermission=!1,t.views=[],t.chartTypes=f.getChartsTypes(),t.showHelp=!1,t.primaryField=t.module.primaryField.name,t.hasBulkUpdatePermission=!1,t.buttonsParametersData={},t.tenantLanguage=tenantLanguage,t.viewChangeStatus=!1,t.gridGroupBy=[];var A=i("filter")(t.module.helps,{modal_type:"side_modal",module_type:"module_list"},!0)[0];A&&(t.showHelp=!0),t.goUrl=function(t){e.globalLoading=!0,window.location=t},t.goUrl2=function(a){var i=window.getSelection();0===i.toString().length&&(t.module.primaryField&&t.module.primaryField.external_link?(e.isViewFilterOpen&&e.isDocked&&e.closeSide("sideModal"),window.location=t.module.primaryField.external_link+"?id="+a):(e.globalLoading=!0,window.location="#/app/record/"+t.module.name+"?id="+a))};var C=t.locale||t.language;if(t.isAdmin||(r.hasCustomProfilePermission("view")&&(t.hasViewPermission=!0),r.hasCustomProfilePermission("record_bulk_update")&&(t.hasBulkUpdatePermission=!0)),t.reportTypeOptions={dataSource:[{value:"summary",title:i("translate")("Report.SummaryReport")},{value:"tabular",title:i("translate")("Report.ListViewReport")},{value:"single",title:i("translate")("Report.Single")}],dataTextField:"title",dataValueField:"value",change:function(){}},!t.module)return h.warning(i("translate")("Common.NotFound")),void o.go("app.dashboard");if(e.breadcrumblist=[{title:null}],t.bulkUpdate={},t.filter={},!t.hasPermission(t.type,t.operations.read))return h.error(i("translate")("Common.Forbidden")),void o.go("app.dashboard");t.changeAggregationType=function(){t.changeView(!1,!0),x()},f.getActionButtons(t.module.id).then(function(a){t.actionButtons=a,t.toolbarOptions={resizable:!0,items:[]},e.processLanguages(a);for(var i=0;a.length>i;i++){const r=e.getLanguageValue(a[i].languages,"label");if("Detail"!==a[i].trigger&&"Form"!==a[i].trigger&&"Relation"!==a[i].trigger){if("Scripting"===a[i].type&&t.hasActionButtonDisplayPermission(a[i],!0)){var l={template:'<md-button class="btn '+a[i].color+'" ng-disabled="disableButton'+a[i].id+' || actionButtonGlobalLoading"  ng-click="runScript('+i+')"  aria-label="'+r+'" > <i ng-show="!disableButton'+a[i].id+'" class="'+a[i].icon+'"></i> <md-progress-circular md-diameter="18px" class="action-button-loading"  ng-show="disableButton'+a[i].id+'" md-mode="indeterminate"></md-progress-circular> <span>'+r+"</span></md-button>",overflowTemplate:'<md-button ng-click="runScript('+i+')" ng-disabled="disableButton'+a[i].id+' || actionButtonGlobalLoading"  class="action-dropdown-item"><i ng-show="!disableButton'+a[i].id+'" class="'+a[i].icon+'"></i> <md-progress-circular md-diameter="18px" class="action-button-loading"  ng-show="disableButton'+a[i].id+'" md-mode="indeterminate"></md-progress-circular> <span> '+r+"</span></md-button>",overflow:"auto"};t.toolbarOptions.items.push(l)}if("Webhook"===a[i].type&&t.hasActionButtonDisplayPermission(a[i],!0)){var l={template:'<md-button class="btn '+a[i].color+'"  ng-click="webhookRequest('+i+')"    aria-label="'+r+'" > <i class="'+a[i].icon+'"></i> <span>'+r+"</span></md-button>",overflowTemplate:'<md-button ng-click="webhookRequest('+i+')"  class="action-dropdown-item" ><i class="'+a[i].icon+'"></i><span> '+r+" </span></md-button>",overflow:"auto"};t.toolbarOptions.items.push(l)}if("ModalFrame"===a[i].type&&t.hasActionButtonDisplayPermission(a[i],!0)){var l={template:'<md-button class="btn '+a[i].color+'"  ng-click="showModuleFrameModal(\''+a[i].url+'\')"   aria-label="'+r+'" > <i class="'+a[i].icon+'"></i> <span>'+r+"</span></md-button>",overflowTemplate:"<md-button  ng-click=\"showModuleFrameModal('"+a[i].url+'\')"   class="action-dropdown-item"><i class="'+a[i].icon+'"></i><span> '+r+" </span></md-button>",overflow:"auto"};t.toolbarOptions.items.push(l)}if("CallMicroflow"===a[i].type&&t.hasActionButtonDisplayPermission(a[i],!0)){var l={template:'<md-button class="btn '+a[i].color+'" ng-disabled="disableButton'+a[i].id+' || actionButtonGlobalLoading" ng-click="runMicroflow('+a[i].microflow_id+","+i+')"   aria-label="'+r+'" >  <i ng-show="!disableButton'+a[i].id+'" class="'+a[i].icon+'"> </i>  <md-progress-circular md-diameter="18px" class="action-button-loading"  ng-show="disableButton'+a[i].id+'" md-mode="indeterminate"></md-progress-circular> <span>'+r+"</span> </md-button>",overflowTemplate:'<md-button ng-click="runMicroflow('+a[i].microflow_id+","+i+')" ng-disabled="disableButton'+a[i].id+' || actionButtonGlobalLoading"  class="action-dropdown-item"><i ng-show="!disableButton'+a[i].id+'" class="'+a[i].icon+'"></i> <md-progress-circular md-diameter="18px" class="action-button-loading"  ng-show="disableButton'+a[i].id+'" md-mode="indeterminate"></md-progress-circular> <span> '+r+"</span></md-button>",overflow:"auto"};t.toolbarOptions.items.push(l)}}}}),t.fields=[],t.fieldskey={},t.selectedRows=[],t.selectedGroups=[],t.groupLastIdsArray=[],t.selectedRecords=[],t.isAllSelected=!1,t.currentUser=f.processUser(e.user),t.currentDayMin=r.getCurrentDateMin().toISOString(),t.currentDayMax=r.getCurrentDateMax().toISOString(),t.currentHour=r.floorMinutes(new Date),t.allFields=[],t.numberFields=[],t.picklistFields=[],t.dateFields=[],t.calculationFields=[],t.aggregationTypes=[{label:i("translate")("Report.sum"),value:"sum"},{label:i("translate")("Report.avg"),value:"avg"},{label:i("translate")("Report.min"),value:"min"},{label:i("translate")("Report.max"),value:"max"}];for(var O=0;O<t.module.fields.length;O++){var G=t.module.fields[O];if(f.hasFieldDisplayPermission(G)){if("multiselect_lookup"===G.data_type)for(var q=e.modulus[G.lookup_type],E=0;E<q.fields.length;E++){var I=q.fields[E];if(f.hasFieldDisplayPermission(I)&&"multiselect_lookup"!==I.data_type&&("lookup"!==I.data_type||"users"===I.lookup_type)){var j=G.name+"."+q.name+"."+I.name;t.allFields.push({name:j,label:I.label+" ("+G.label+")",data_type:G.data_type,lookuplabel:G.label,multiselectLookupField:G.name}),t.fieldskey[j]=I}}else{var N={name:G.name,label:G.label,data_type:G.data_type,lookuplabel:"- "+t.module.languages[e.globalization.Label].label.plural};t.allFields.push(N)}t.fieldskey[G.name]=G,"numeric"===G.data_type||"number"===G.data_type||"number_auto"===G.data_type||"currency"===G.data_type||"number_decimal"===G.data_type?t.numberFields.push(G):"date"===G.data_type||"date_time"===G.data_type?t.dateFields.push(G):("picklist"===G.data_type||"droplist"===G.data_type)&&t.picklistFields.push(G)}}t.parseInt=function(e){return parseInt(e)},t.colorPaletOptions={columns:6,palette:["#D24D57","#BE90D4","#5AABE3","#87D37C","#F4D03E","#B8BEC2","#DC3023","#8e44ad","#19B5FE","#25A65B","#FFB61E","#959EA4","#C3272B","#763668","#1F4688","#006442","#CA6924","#4D5C66"]};var U=function(e){var a=t.freezeDependencies||D(t.module.dependencies);a&&a.length>0&&(F(a,e,!1),t.isAllSelected&&(t.isAllSelected=!1,t.selectAll(void 0,e)))};t.chartFilter=function(a){e.activeView.aggregation.aggregation_type&&e.activeView.aggregation.field||(e.activeView.aggregation={aggregation_type:"count",field:"created_by"},t.totalCount=!0);var r=t.fieldskey[e.activeView.group_field];if("groupField"===a&&(t.reportSummary.chart.xaxisname=e.getLanguageValue(r.languages,"label"),t.reportSummary.chart.yaxisname=t.totalCount?i("translate")("Report.count"):"Report."+e.activeView.aggregation.aggregation_type),"aggregationType"===a&&(t.reportSummary.chart.yaxisname=i("translate")(t.totalCount?"Report.count":"Report."+e.activeView.aggregation.aggregation_type)),r&&"lookup"===r.data_type)var l=r.name+"."+r.lookup_type+"."+r.lookupModulePrimaryField.name;var o={module_name:t.module.name,aggregation_field:e.activeView.aggregation.aggregation_type+"("+e.activeView.aggregation.field+")",chart_type:t.reportSummary.chart.chart_type,aggregation_type:e.activeView.aggregation.aggregation_type,group_by:l||e.activeView.group_field,filters:e.activeView.filters,filter_logic:e.activeView.filter_logic||""};f.chartFilter(o).then(function(a){t.reportSummary.data=a.data,t.reportSummary.isNew||t.initilazSummaryReport(),t.loading=!1,e.globalLoading=!1})},t.widgetFilter=function(){e.activeView.aggregation.aggregation_type&&e.activeView.aggregation.field||(e.activeView.aggregation={aggregation_type:"count",field:"created_by"},t.totalCount=!0);var a=e.activeView.aggregation.aggregation_type+"("+e.activeView.aggregation.field+")",i={fields:[a],limit:1,offset:0,filters:e.activeView.filters};f.findRecords(t.module.name,i).then(function(a){e.activeView.value=a.data[0][e.activeView.aggregation.aggregation_type],t.loading=!1,e.globalLoading=!1})},t.filtera={group:{logic:"and",filters:[],level:1}};var z=0,Y=[];t.count=0;var H=[];if(t.processViewFilter=function(e,a){var r=t.fieldskey[e.field.name],l={field:e.field.name,operator:e.operator.name,no:a};switch(e.field.multiselectLookupField&&""!=e.field.multiselectLookupField&&H.push(e.field.multiselectLookupField),r.data_type){case"date_time":case"date":if(e.value&&e.value.name)switch(e.value.value){case"costumeN":if(!e.valueX&&!e.nextprevdatetype&&!e.nextprevdatetype.value)return!1;l.value="today("+e.valueX+e.nextprevdatetype.value+")";break;case"costumeM":if(!e.valueX&&!e.nextprevdatetype&&!e.nextprevdatetype.value)return!1;l.value="this_month("+e.valueX+e.nextprevdatetype.value+")";break;case"costumeW":if(!e.valueX&&!e.nextprevdatetype&&!e.nextprevdatetype.value)return!1;l.value="this_week("+e.valueX+e.nextprevdatetype.value+")";break;case"costumeY":if(!e.valueX&&!e.nextprevdatetype&&!e.nextprevdatetype.value)return!1;l.value="this_year("+e.valueX+e.nextprevdatetype.value+")";break;default:if("costume"===e.value.name){if(!e.costumeDate)return!1;l.value="date_time"===r.data_type?e.costumeDate:i("date")(e.costumeDate,"MM/dd/yyyy")}else l.value=e.value.value}break;case"multiselect":for(var o=[],n=0;n<e.value.length;n++){var s=e.value[n];o.push(s.labelStr)}l.value=o;break;case"multiselect_droplist":for(var o=[],n=0;n<e.value.length;n++){var d=e.value[n];o.push(d.name)}l.value=o;break;case"tag":for(var o="",n=0;n<e.value.length;n++)o+=e.value[n].text+"|";l.value=o.slice(0,-1);break;case"lookup":"users"===r.lookup_type?l.value=e.value.id:(l.field=r.name+"."+r.lookup_type+"."+r.lookupModulePrimaryField.name,l.value=e.value,H.push(l.field));break;case"picklist":e.operator&&"empty"!==e.operator.name&&"not_empty"!==e.operator.name&&(l.value=i("filter")(t.fieldskey[e.field.name].picklist,{id:parseInt(e.value)},!0)[0].labelStr);break;case"checkbox":e.value&&(l.value=angular.isObject(e.value)?e.value.value:e.value);break;case"number":case"number_decimal":if(!e.value)return"";l.value=e.value;break;default:l.value=e.value}return("empty"===l.operator||"not_empty"===l.operator)&&(l.value="-"),l},t.setListGrid=function(a){var i=e.activeView;"report"===a?(i.report_type="tabular",i.view_type="report"):(i.report_type="",i.view_type="grid"),i.aggregations=null,i.aggregation=null,t.changeView(i,!1)},t.reportTypeChange=function(){switch(x(),e.activeView.report_type){case"tabular":t.setListGrid("report");break;case"summary":t.reportSummary={config:{dataEmptyMessage:i("translate")("Dashboard.ChartEmptyMessage")}},t.totalCount=!0,e.activeView.aggregation={field:"",aggregation_type:""},t.reportSummary.config={dataEmptyMessage:i("translate")("Dashboard.ChartEmptyMessage")},t.reportSummary.isNew=!0,t.reportSummary.chart={languages:{}},t.reportSummary.chart[e.globalization.Label]={xaxisname:"",yaxisname:""},t.reportSummary.chart.chart_type="column3d",t.reportSummary.chart.report_aggregation_field=e.activeView.aggregation.field,t.reportSummary.chart.showToolTip=e.isMobile()?"0":"1",t.reportSummary.chart.showPercentValues="1",t.reportSummary.chart.showPercentInTooltip="0",t.reportSummary.chart.animateClockwise="1",t.reportSummary.chart.enableMultiSlicing="0",t.reportSummary.chart.isHollow="0",t.reportSummary.chart.is2D="0",t.reportSummary.chart.formatNumberScale="0",t.reportSummary.chart.exportEnabled="1",t.reportSummary.chart.exportTargetWindow="_self",t.reportSummary.chart.exportFileName=t.reportSummary.chart.languages?e.getLanguageValue(t.reportSummary.chart.languages,"caption"):"",t.reportSummary.chart.exportFormats="PNG="+i("translate")("Report.ExportImage")+"|PDF="+i("translate")("Report.ExportPdf")+"|XLS=Export Chart Data";break;case"single":t.totalCount=!0,e.activeView.aggregation={field:"created_by",aggregation_type:"count"},t.widgetFilter()}},t.changeViewType=function(a){return e.activeView.view_type===a?!1:(!t.selectedFieldsRecovery&&t.viewFields&&(t.selectedFieldsRecovery=t.viewFields.selectedFields),"grid"===a?(e.activeView.groups_json=null,e.activeView.aggregations=[],e.activeView.report_type="",e.activeView.view_type="grid",t.gridGroupBy=[],(!e.activeView.fields||e.activeView.fields.length<1)&&(e.activeView.fields=t.newGridData.fields),t.setListGrid("grid")):"report"===a?(e.activeView.view_type="report",e.activeView.report_type="tabular",e.activeView.groups_json=null,t.gridGroupBy=[],t.setListGrid("report"),t.setViewAggregationsFields(t.viewFields.selectedFields)):"calendar"===a?(e.activeView.view_type="calendar",e.activeView.report_type="",e.activeView.groups_json=null,t.gridGroupBy=[],t.setViewCalendar()):"kanban"===a&&(e.activeView.view_type="kanban",e.activeView.report_type="",e.activeView.groups_json=null,t.gridGroupBy=[],e.activeView.settings=null,t.setViewKanban()),void x())},t.viewFilter=function(){if(z=0,Y=[],H=[],t.checkFilterValid(t.filtera)){var a=R(t.filtera);return e.activeView.filters=Y,e.activeView.filter_logic=Y.length>1?a:"","summary"===e.activeView.report_type?(t.chartFilter(),!0):("calendar"!=e.activeView.view_type&&t.changeView(!1,!0),"single"===e.activeView.report_type?(t.widgetFilter(),!0):"calendar"===e.activeView.view_type?(t.refreshViewCalendar(),!1):void 0)}},t.checkFilterValid=function(e){if(e.group&&e.group.filters&&e.group.filters.length>0){for(var a=0;a<e.group.filters.length;a++){var i=e.group.filters[a];if(null!=i.group){if(!t.checkFilterValid(i))return!1}else{if(null==i.operator||""===i.operator||null==i.operator.name||""===i.operator.name)return!1;if(!("lookup"!==i.field.data_type&&"picklist"!==i.field.data_type&&"multiselect"!==i.field.data_type&&"multiselect_lookup"!==i.field.data_type||null!==i.value&&""!==i.value))return!1}}return!0}return!0},t.initilazSummaryReport=function(){if(t.module){if(e.activeView.group_field.indexOf(".")<0){var a=t.fieldskey[e.activeView.group_field];a&&(t.reportSummary.groupField=e.getLanguageValue(a.languages,"label"))}else{var r=e.activeView.group_field.split("."),l=i("filter")(e.modules,{name:r[1]},!0)[0],o=i("filter")(t.module.fields,{name:r[0]},!0)[0],n=i("filter")(l.fields,{name:r[2]},!0)[0];t.reportSummary.groupField=e.getLanguageValue(n.languages,"label")+" ("+e.getLanguageValue(o.languages,"label")+")"}e.activeView.aggregations&&angular.isArray(e.activeView.aggregations)&&(e.activeView.aggregation=e.activeView.aggregations[0]);var s;if(e.activeView.aggregation.field.indexOf(".")<0)s=t.fieldskey[e.activeView.aggregation.field];else{var d=e.activeView.aggregation.field.split("."),u=t.module[d[1]];s=i("filter")(u.fields,{name:d[2]},!0)[0]}s&&"currency"===s.data_type&&(t.reportSummary.chart.numberPrefix=e.currencySymbol),!s||"currency"!==s.data_type&&"number_decimal"!==s.data_type||(t.reportSummary.chart.forceDecimals="1")}t.loading=!1,e.globalLoading=!1},t.setSummary=function(a){t.reportSummary={config:{dataEmptyMessage:i("translate")("Dashboard.ChartEmptyMessage")}},t.current={field:"",direction:""},f.getChart(a.id).then(function(a){var r=angular.isObject(a.data.chart.languages)?a.data.chart.languages:JSON.parse(a.data.chart.languages);t.reportSummary=a.data,t.reportSummary.config={dataEmptyMessage:i("translate")("Dashboard.ChartEmptyMessage")},t.reportSummary.chart.showToolTip=e.isMobile()?"0":"1",t.reportSummary.chart.showPercentValues="1",t.reportSummary.chart.showPercentInTooltip="0",t.reportSummary.chart.animateClockwise="1",t.reportSummary.chart.enableMultiSlicing="0",t.reportSummary.chart.isHollow="0",t.reportSummary.chart.is2D="0",t.reportSummary.chart.formatNumberScale="0",t.reportSummary.chart.exportEnabled="1",t.reportSummary.chart.exportTargetWindow="_self",t.reportSummary.chart.exportFileName=e.getLanguageValue(t.reportSummary.chart.languages,"caption"),t.reportSummary.chart.exportFormats="PNG="+i("translate")("Report.ExportImage")+"|PDF="+i("translate")("Report.ExportPdf")+"|XLS=Export Chart Data",t.reportSummary.chart.xaxisname=r[e.globalization.Label].xaxis_name,t.reportSummary.chart.yaxisname=r[e.globalization.Label].yaxis_name,"tr"===t.locale&&(t.reportSummary.chart.decimalSeparator=",",t.reportSummary.chart.thousandSeparator="."),t.initilazSummaryReport(),e.globalLoading=!1})},t.setSingleReport=function(a){f.getWidget(a.id).then(function(a){var i=a.data[0];e.activeView.color=i.color,e.activeView.field=i.field,e.activeView.icon=i.icon,e.activeView.type=i.type,e.activeView.value=i.value,e.activeView.aggregation={field:i.field,aggregation_type:i.type},t.loading=!1,e.globalLoading=!1})},t.setView=function(a){if(a){if(t.selectedFieldsRecovery=null,t.viewChangeStatus=!1,o.go("app.moduleList",{type:t.module.name,viewid:a.id},{notify:!1}),e.activeView=a,"report"===a.view_type)switch(("summary"===a.report_type||"single"===a.report_type)&&a.aggregations&&a.aggregations.length>0&&(t.totalCount="count"===a.aggregations[0].aggregation_type?!0:!1),a.report_type){case"summary":t.setSummary(a);break;case"tabular":if(e.activeView=a,a.aggregations)for(var r=0;r<a.fields.length;r++)if(t.fieldskey[a.fields[r].field]&&("numeric"===t.fieldskey[a.fields[r].field].data_type||"number"===t.fieldskey[a.fields[r].field].data_type||"number_auto"===t.fieldskey[a.fields[r].field].data_type||"currency"===t.fieldskey[a.fields[r].field].data_type||"number_decimal"===t.fieldskey[a.fields[r].field].data_type)){var l=i("filter")(a.aggregations,{field:a.fields[r].field})[0];l||a.aggregations.push({field:a.fields[r].field})}t.changeView(e.activeView);break;case"single":t.setSingleReport(a)}else"grid"===a.view_type?(t.gridGroupBy=e.activeView.groups_json?JSON.parse(e.activeView.groups_json):[],t.gridGroupLookupCheck(),t.changeView(e.activeView)):"calendar"===a.view_type?(e.activeView.settings&&!angular.isObject(e.activeView.settings)&&(e.activeView.settings=JSON.parse(e.activeView.settings)),t.loading=!1,t.setViewCalendar()):"kanban"===a.view_type&&(e.activeView.settings&&!angular.isObject(e.activeView.settings)&&(e.activeView.settings=JSON.parse(e.activeView.settings)),t.loading=!1,f.getPicklists(t.module).then(function(a){e.processPicklistLanguages(a),t.picklistsModule=a,t.setViewKanban()}));"report"===e.activeView.view_type&&"tabular"===e.activeView.report_type&&e.activeView.aggregations&&e.activeView.aggregations.length>0&&e.activeView.aggregations[0].aggregation_type&&(e.activeView.aggregation=e.activeView.aggregations[0]),e.activeView.filter_logic_json&&(t.filtera=JSON.parse(e.activeView.filter_logic_json),L(t.filtera,!0))}},t.getProfilisByIds=function(t){var a=[];if(t)for(var r=0;r<t.length;r++){var l=i("filter")(e.profiles,{id:parseInt(t[r])},!0)[0];l&&a.push(l)}return a},t.saveModal=function(a){if(!a.validate()||!t.validSelectedFields())return h.error(i("translate")("Module.RequiredError")),!0;if(e.user.profile.has_admin_rights||(e.activeView.sharing_type="me"),"profile"===e.activeView.sharing_type&&(e.activeView.profile=t.getProfilisByIds(e.activeView.profiles)),"report"===e.activeView.view_type&&"summary"===e.activeView.report_type&&!e.activeView.group_field)return void h.error(i("translate")("Module.RequiredError"));e.preview&&(e.activeView.editable="custom"===e.activeView.system_type?!0:!1),t.viewIsSaveing=!1;var r=angular.element(document.body);b.show({parent:r,templateUrl:"view/app/module/common/viewSaveModal.html",clickOutsideToClose:!1,scope:t,preserveScope:!0})},t.viewNameMax=function(){t.viewName.length>50&&(t.viewName=e.getLanguageValue(e.activeView.languages,"label"),h.error(i("translate")("View.ViewNameMaxLength",{maxLength:50})))},t.SaveView=function(a){if(!t.viewSaveModalForm.validate())return h.error(i("translate")("Module.RequiredError")),void(t.viewIsSaveing=!1);var r=angular.copy(t.filtera);L(r);var l={};if("add"===a?(t.viewIsSaveing=!0,l[e.globalization.Label]=Object.assign({},e.activeView.languages[e.globalization.Label])):l=Object.assign({},e.activeView.languages),t.selectedFieldsAll&&t.selectedFieldsAll.length>3&&(t.viewFields.selectedFields=t.selectedFieldsAll),t.viewFields&&t.viewFields.selectedFields){e.activeView.fields=[];for(var o=0;o<t.viewFields.selectedFields.length;o++){var n=t.viewFields.selectedFields[o].name;"lookup"!==t.viewFields.selectedFields[o].data_type||t.viewFields.selectedFields[o].labelExt?e.activeView.fields.push({field:t.viewFields.selectedFields[o].name,order:o}):(n=n.split(".")[0],e.activeView.fields.push({field:n,order:o}),e.activeView.fields.push({field:t.viewFields.selectedFields[o].name+".primary",order:o}))}}e.activeView.filter_logic_json=JSON.stringify(r);var s={filters:e.activeView.filters,module_id:e.activeView.module_id,sharing_type:e.activeView.sharing_type,filter_logic_json:e.activeView.filter_logic_json,view_type:e.activeView.view_type,languages:l,filter_logic:e.activeView.filter_logic};if(s.languages[e.globalization.Label].label=t.viewName||e.getLanguageValue(e.activeView.languages,"label"),"report"===e.activeView.view_type?s.report_type=e.activeView.report_type:"grid"===e.activeView.view_type?(s.fields=e.activeView.fields,s.report_type="",s.aggregations=e.activeView.aggregations.length>0?i("filter")(e.activeView.aggregations,{active:!0}):null,s.groups_json=t.gridGroupBy.length>0?JSON.stringify(t.gridGroupBy):null):("calendar"===s.view_type||"kanban"===s.view_type)&&(s.fields=e.activeView.fields,s.settings=JSON.stringify(e.activeView.settings),s.report_type="",s.aggregations=null,s.groups_json=null),"edit"===a&&(s.id=e.activeView.id),"custom"===e.activeView.sharing_type){if(s.shares=[],e.activeView.shares.length<1)return h.error(i("translate")("Module.RequiredError")),t.viewIsSaveing=!1,!1;for(var d=0;d<e.activeView.shares.length;d++)s.shares.push(e.activeView.shares[d].id)}if("profile"===e.activeView.sharing_type){if(s.profiles=[],!e.activeView.profile)return void(t.viewIsSaveing=!1);for(var o=0;o<e.activeView.profile.length;o++)s.profiles.push(e.activeView.profile[o].id);if(0===s.profiles.length)return}switch(e.activeView.report_type){case"summary":s.group_field=e.activeView.group_field,s.sort_field=e.activeView.sort_field,s.sort_direction="asc",s.filter_logic=e.activeView.filter_logic,s.aggregations=[{field:e.activeView.aggregation.field,aggregation_type:e.activeView.aggregation.aggregation_type}],s.chart={type:t.reportSummary.chart.chart_type,languages:{}},s.chart.languages[e.globalization.Label]={caption:s.languages[e.globalization.Label].label,name:s.languages[e.globalization.Label].label,xaxis_name:t.reportSummary.chart.xaxisname,yaxis_name:t.reportSummary.chart.yaxisname};break;case"tabular":s.fields=e.activeView.fields,s.aggregations=e.activeView.aggregations;break;case"single":s.aggregations=[{field:e.activeView.aggregation.field||"created_by",aggregation_type:e.activeView.aggregation.aggregation_type||"count"}],s.widget={color:e.activeView.color,icon:e.activeView.icon,languages:{}},s.widget.languages[e.globalization.Label]={name:e.getLanguageValue(e.activeView.languages,"label")}}e.preview&&(s["default"]=e.activeView["default"],s.system_type=e.activeView.editable?"custom":"system"),e.languageStringify(s),f.saveView(a,s).then(function(){h.success(i("translate")("View.ViewUpdateSucces")),f.getViews(t.module).then(function(a){t.viewName=void 0,e.processLanguages(a),t.views=a,t.views.reverse(),e.activeView=t.views[0],c.put(t.module.name+"-activeView",e.activeView);var r=i("filter")(t.views,{"default":!0},!0)[0];if(r){var l=t.views.indexOf(r);t.views[l]=e.activeView,t.views[0]=r}if(e.activeView.shares){for(var o=[],n=0;n<e.activeView.shares.length;n++)o.push({id:e.activeView.shares[n].user_id,full_name:e.activeView.shares[n].user.full_name});e.activeView.shares=o}t.processViewFilterFirst(e.activeView),t.setView(e.activeView)}),t.closeLightBox(),e.isDocked||e.closeSide("sideModal")})},t.usersArray=[],t.users.length>0)for(var O=0;O<t.users.length;O++)t.usersArray.push({id:t.users[O].id,full_name:t.users[O].full_name});t.sharesOptions={dataSource:t.usersArray,filter:"contains",dataTextField:"full_name",dataValueField:"id",optionLabel:i("translate")("Common.Select")},t.profilesOptions={dataSource:e.profiles,filter:"contains",dataTextField:"label",dataValueField:"id",optionLabel:i("translate")("Common.Select")},t.reloadFieldSelection=function(){var e=$("#available-fields").data("kendoListBox"),a=$("#selected-fields").data("kendoListBox");if(e)for(t.selectedFieldsOptions.dataSource=new kendo.data.DataSource({data:t.viewFields.selectedFields}),t.availableFieldsOptions.dataSource=new kendo.data.DataSource({data:t.preview?t.viewFields.availableFields:i("filter")(t.viewFields.availableFields,{name:"!is_sample"},!0)}),e.setDataSource(t.availableFieldsOptions.dataSource),a.setDataSource(t.selectedFieldsOptions.dataSource),O=0;e.options.dataSource._data.length>O;O++)e.options.dataSource._data[O].name.includes("seperator-")&&e.enable($(".k-item").eq(O),!1)},t.refreshColumn=function(a){setTimeout(function(){x();var r=$("#selected-fields").data("kendoListBox"),l=$("#available-fields").data("kendoListBox"),o=r.wrapper.find(".k-item"),n=l.wrapper.find(".k-item"),s=[],d=[];$.each(o,function(e,t){s.push(r.dataItem(t))}),$.each(n,function(e,t){d.push(l.dataItem(t))}),t.viewFields.selectedFields=s,t.viewFields.availableFields=i("orderBy")(d,"order"),a||t.reloadFieldSelection(),"tabular"===e.activeView.report_type?t.setViewAggregationsFields(t.viewFields.selectedFields):"grid"===e.activeView.view_type&&(t.gridGroupAggregationFields(t.viewFields.selectedFields),t.gridGroupFields(t.viewFields.selectedFields)),t.changeView(!1,!0)},200)},t.changeView=function(a,r){t.selectedRows.length>0&&(t.isAllSelected=!1,t.selectedRows=[],t.selectedGroups=[]),e.globalLoading=!0,r||(e.activeView=a,a.filter_logic_json&&(t.filtera=JSON.parse(a.filter_logic_json),L(t.filtera,!0)),t.viewFields=f.getViewFields(t.module,e.activeView),t.selectedFieldsRecovery&&(t.viewFields.selectedFields=t.selectedFieldsRecovery),t.viewFields.selectedFields.length>0&&(t.groupByFields=i("filter")(t.viewFields.selectedFields,function(e){return"multiselect_lookup"!=e.data_type&&"multiselect"!=e.data_type&&"multiselect_droplist"!=e.data_type},!0)),t.availableFieldsOptions={disabled:!0,draggable:!0,dataTextField:"label",dataValueField:"name",connectWith:"selected-fields",autoScroll:!0,dataSource:t.preview?t.viewFields.availableFields:i("filter")(t.viewFields.availableFields,{name:"!is_sample"},!0),dropSources:["selected-fields"],template:"<div class='list-title'>#:label#</div>",enable:function(){},reorder:function(e){e.preventDefault()},add:function(e){var a=e.dataItems[0];if(a.labelExt){var r=a.name.substring(0,a.name.lastIndexOf(".")),l=i("filter")(t.viewFields.availableFields,function(e){return e.name.indexOf(r)>-1&&e.labelExt===a.labelExt});l&&l.length>0&&(a.parent_id=l[0].parent_id,a.order+=a.parent_id)}else a.parent_id=0;t.refreshColumn()}},t.selectedFieldsOptions={draggable:!0,dataTextField:"label",dataValueField:"name",autoScroll:!0,template:"<div class='list-title'>#:label# #:labelExt ?? ''#</div>",connectWith:"available-fields",dataSource:t.viewFields.selectedFields,dropSources:["available-fields"],reorder:function(){t.refreshColumn(!0)},add:function(){t.refreshColumn()}},t.reloadFieldSelection()),"grid"!==e.activeView.view_type?t.gridGroupBy=[]:(e.activeView.groups_json=t.gridGroupBy.length>0?JSON.stringify(t.gridGroupBy):null,t.gridGroupBy=e.activeView.groups_json?JSON.parse(e.activeView.groups_json):[]);var l={moduleName:t.module.name};if("report"===e.activeView.view_type&&e.activeView.report_type?l.activeView=e.activeView:"grid"===e.activeView.view_type&&(l.activeView=e.activeView,l.gridGroupBy=t.gridGroupBy),e.isMobile()){for(var o=[],n=t.viewFields.selectedFields.length>3?3:t.viewFields.selectedFields.length,s=0;n>s;s++)o.push(t.viewFields.selectedFields[s]);t.selectedFieldsAll=t.viewFields.selectedFields,t.viewFields.selectedFields=o}var d=f.generatRowtmpl(t.viewFields.selectedFields,!1,l,t.module);if("report"===e.activeView.view_type&&"tabular"===e.activeView.report_type&&e.activeView.aggregations&&d.columns.map(function(a){for(var i=0;i<e.activeView.aggregations.length;i++)if(a.field===e.activeView.aggregations[i].field&&e.activeView.aggregations[i].aggregation_type){var r=e.activeView.aggregations[i].aggregation_type+"("+e.activeView.aggregations[i].field+")";
a.footerTemplate="<div> {{ 'Report."+e.activeView.aggregations[i].aggregation_type+"' | translate  }} : {{ "+r.replace("(","_").replace(")","")+"}} </div>";for(var l={fields:[r],limit:1,offset:0,filters:e.activeView.filters},o=0;o<e.activeView.filters.length;o++)e.activeView.filters[o].field.split(".").length>0&&l.fields.push(e.activeView.filters[o].field);f.findRecords(t.module.name,l).then(function(e){var a=e.data[0][e.config.data.fields[0].split("(")[0]];!Number.isInteger(a)&&a.toString().contains(".")&&(a=parseFloat(a).toFixed(2)),t[e.config.data.fields[0].replace("(","_").replace(")","")]=a})}}),H&&H.length>0&&(d.requestFields=d.requestFields.concat(H)),t.findRequest={module:t.module.name,filter_logic:e.activeView.filter_logic,filters:e.activeView.filters,convert:!0,fields:d.requestFields},T(),M(),t.freezeDependencies=D(t.module.dependencies),t.freezeDependencies&&(t.freezeFields=F(t.freezeDependencies,void 0,!0),t.freezeFields))for(var u=0;u<t.freezeFields.length;u++)t.findRequest.fields.indexOf(t.freezeFields[u].name)<0&&t.findRequest.fields.push(t.freezeFields[u].name);if(c.put(t.module.name+"-activeView",e.activeView),c.put(t.module.name+"-activeViewFields",t.viewFields.selectedFields),e.activeView.filter_logic_json=JSON.stringify(t.filtera),t.loading=!0,t.executeCode=!1,w.run("BeforeListRequest","Script",t),!t.executeCode)if("tabular"===e.activeView.report_type||"grid"===e.activeView.view_type){var p=null;"grid"===e.activeView.view_type?(t.groupFieldChecked(),t.gridGroupAggregationFields(t.viewFields.selectedFields),t.aggregationsOrder(),t.findRequest.aggregations=i("filter")(e.activeView.aggregations,{active:!0}),t.findRequest.type="grid",t.findRequest.groupDate=t.gridGroupBy.length>0?t.gridGroupBy:void 0,p={serverPaging:!0,serverFiltering:!0,serverSorting:!0,serverGrouping:!0,serverAggregates:!0,group:t.gridGroupBy.length>0?t.gridGroupBy:void 0,transport:{read:function(a){t.findRequest.limit=a.data.take;var i=Object.assign(JSON.parse(JSON.stringify(t.findRequest)),a.data);P(i),$.ajax({url:"/api/record/find_custom?locale="+C,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify(i),success:function(i){if(i.data&&i.data.length>0&&U(i.data),a.success(i),e.globalLoading=!1,e.isMobile()||$(".k-pager-wrap").removeClass("k-pager-sm"),$(".k-grid-footer").hide(),0===t.gridGroupBy.length)$(".k-grouping-header").hide();else{$(".k-grouping-header").show();{$("tbody tr td:only-child p.k-reset").each(function(){var e=$(this).children();$(e).insertAfter($(e).next("input"))})}}},beforeSend:e.beforeSend()})}},schema:{data:"data",total:"total",model:{id:"id"},groups:"groups",aggregates:"aggregates",parse:function(e){return e.groups=t.parseGridData(e),t.loading=!1,e}}}):p={serverPaging:!0,serverFiltering:!0,serverSorting:!0,transport:{read:function(a){$.ajax({url:"/api/record/find_custom?locale="+C,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify(Object.assign(t.findRequest,a.data)),success:function(i){if(i.data&&i.data.length>0&&U(i.data),a.success(i),e.globalLoading=!1,t.loading=!1,e.isMobile()||$(".k-pager-wrap").removeClass("k-pager-sm"),"report"===e.activeView.view_type&&i.total_count<1)$(".k-grid-footer").addClass("hide");else{var r=!1;if(e.activeView.aggregations)for(var l=0;l<e.activeView.aggregations.length;l++){var o=e.activeView.aggregations[l];o.field&&o.aggregation_type&&(r=!0)}r?"":$(".k-grid-footer").addClass("hide")}},beforeSend:e.beforeSend()})}},schema:{data:"data",total:"total",model:{id:"id"}}},t.mainGridOptions={dataSource:p,rowTemplate:'<tr ng-click="goUrl2(dataItem.id)">'+d.rowtempl+"</tr>",altRowTemplate:'<tr class="k-alt" ng-click="goUrl2(dataItem.id)">'+d.rowtempl+"</tr>",scrollable:!1,groupable:"tabular"===e.activeView.report_type?!1:t.gridGroupBy.length>0?0:1,sortable:"tabular"===e.activeView.report_type?!0:t.gridGroupBy.length>0?0:1,noRecords:!0,pageable:{refresh:!0,pageSize:10,pageSizes:[10,25,50,100,500],buttonCount:5,info:!0},columns:d.columns}}else if("kanban"===e.activeView.view_type&&e.activeView.settings&&e.activeView.settings.kanbanPicklist){if(t.kanbanSelectPicklist=t.fieldskey[e.activeView.settings.kanbanPicklist],t.kanbanBoards(),!t.kanbanSelectPicklist)return;-1===d.requestFields.indexOf(t.kanbanSelectPicklist.name)&&d.requestFields.push(t.kanbanSelectPicklist.name),H.length>0&&d.requestFields.concat(H),t.findRequestKanban={module:t.module.name,filter_logic:e.activeView.filter_logic,filters:e.activeView.filters,convert:!0,fields:d.requestFields,picklist_name:t.kanbanSelectPicklist.name,exclude_count:"no"},t.getItemCount=t.findRequestKanban.fields.length<=3?15:10,t.boards&&t.boards.length>0&&t.boards.forEach(function(e){t.kanbanListViewAltOptionsSet(e)}),t.kanbanMainOptions={template:t.boardTemplateMain(),dataSource:t.boards},k(function(){var e=$("#modul-area-app").innerHeight(),t=$("#modul-area-app-menu").innerHeight();$("#kanban-view").height(e-t-50)},250),t.sortableKanbanOptions={filter:".card",container:".board",connectWith:".k-listview-content",cursor:"grabbing",placeholder:function(e){return $('<div class="card"></div>').css({background:"#fff",height:e[0].offsetHeight+"px",margin:"10px 20px"})},autoScroll:!0,change:function(e){if("receive"===e.action){var a=parseInt(e.item[0].id.split("-")[2]),r=parseInt(e.sender.element[0].parentElement.id.split("-")[2]),l={id:a};"droplist"===t.kanbanSelectPicklist.data_type&&0!==r&&(r=i("filter")(t.boards,{id:r})[0].name),l[t.kanbanSelectPicklist.name]=0!==r?r:null,f.updateRecord(t.module.name,l).then(function(){h.success(i("translate")("Module.UpdateRecordBulkSuccess"))})["catch"](function(){h.error(i("translate")("Common.Error"))})}else{var o=parseInt(e.sender.element[0].parentElement.id.split("-")[2]),n=$("#list-kanban-"+o+" .k-listview-content .card");if(n&&n.length<10&&!t["getItems"+o]){t["getItems"+o]=!0,t["page"+o]++;var s=$("#list-kanban-"+o),d=s.data("kendoListView");t["scrollData"+o].query({page:t["page"+o],pageSize:t.getItemCount}).then(function(){var e=t["scrollData"+o].data();if(e.length>0){for(var a=0;a<e.length;a++)d.dataSource.pushCreate(e[a]);t["scroll"+o]=!0}})}}},end:function(){$(".left-right-to-items").remove(),$(".item-block-same-area").remove()},hint:function(e){var t=$("#board .k-listview-content:first");t.prepend("<div style='height: 100%; width: 12%; position:fixed; z-index: 10000; left:0;' class='list-header left-right-to-items'></div> <div style='height: 100%; width: 12%; position:fixed; z-index: 10000; right:0;' class='list-header left-right-to-items'></div>");var a=parseInt(e[0].parentElement.parentElement.id.split("-")[2]);return $("#list-kanban-"+a).prepend("<div style='height: 100%; width: 100%; position:absolute; z-index: 10000;' class='item-block-same-area'></div>"),e.clone().css({width:"17em",background:"white",boxShadow:"0 0.5rem 0.75rem rgba(0, 0, 0, 0.075)"})}}}},t.groupFieldChecked=function(){if(t.gridGroupBy&&t.gridGroupBy.length>0)for(var e=0;e<t.gridGroupBy.length;e++){var a=t.viewFields.availableFields.concat(t.viewFields.selectedFields),r=i("filter")(a,{name:t.gridGroupBy[e].field},!0)[0];r||(t.gridGroupBy[e].field=t.viewFields.selectedFields[e].name)}},f.getViews(t.module).then(function(a){if(e.processLanguages(a),t.views=a,t.shadowViews=angular.copy(a),t.views.length<1)return t.loading=!1,void(e.globalLoading=!1);t.views.reverse();var r=!1,l=i("filter")(t.views,{"default":!0},!0)[0]||t.views[0];!e.activeView||e.activeView&&e.activeView.module_id!==t.module.id?e.activeView=l:(e.activeView=i("filter")(t.views,{id:e.activeView.id},!0)[0],r=!0);var o=-1;r?(o=t.views.indexOf(l),t.views[o]=t.views[0],t.views[0]=l):(o=t.views.indexOf(e.activeView),t.views[o]=t.views[0],t.views[0]=e.activeView);for(var s=0;s<t.views.length;s++)if(t.views[s].shares&&t.views[s].shares.length>0){for(var d=[],u=0;u<t.views[s].shares.length;u++)d.push({id:t.views[s].shares[u].user_id,full_name:t.views[s].shares[u].user.full_name});t.views[s].shares=d}if(n.viewid)return t.viewid=n.viewid,e.activeView=i("filter")(t.views,{id:parseInt(t.viewid)},!0)[0],e.activeView||(e.activeView=t.views[0]),e.activeView.filter_logic_json&&(t.filtera=JSON.parse(e.activeView.filter_logic_json),L(t.filtera,!0)),t.processViewFilterFirst(e.activeView),t.setView(e.activeView),!0;var p=c.get(t.module.name+"-activeView");return p?(t.processViewFilterFirst(e.activeView),t.setView(p),!0):(t.processViewFilterFirst(e.activeView),void t.setView(e.activeView))}),t.parseGridData=function(e){var a=[];if(t.gruopFilters=[],t.groupLastIdsArray=[],t.records=e.data,e.data&&e.data.length>0&&1===t.gridGroupBy.length)for(var r=t.gridGroupBy[0].field,l=0;l<e.data.length;l++){var o="";o=null===t.gridGroupBy[0].dateType||"date_time"!==t.gridGroupBy[0].data_type&&"date"!==t.gridGroupBy[0].data_type&&"time"!==t.gridGroupBy[0].data_type?e.data[l][r]:t.groupDateSortName(t.gridGroupBy[0].dateType,e.data[l][r]),o=o.toString();var n=i("filter")(a,{value:o},!0)[0];if(n)n.items.push(e.data[l]);else{var s={field:r,value:o,items:[e.data[l]],hasSubgroups:!1},d=i("filter")(t.module.fields,{name:r.split(".")[0]},!0)[0],u=r.split(".");u.length>1&&(u=u[0]+"."+u[1]+".id");var c=e.data[l][u].toString();"currency"===d.data_type&&(c=c.slice(1)),t.gruopFilters.push({field:r.split(".")[0],value:c,operator:d.operators[0].name,no:1}),s.aggregates=t.aggregateParse(e,e.data[l][r],d),a.push(s)}}else if(e.data&&e.data.length>0&&2===t.gridGroupBy.length){for(var p=t.gridGroupBy[0].field,g=0;g<e.data.length;g++){var o="";o=null===t.gridGroupBy[0].dateType||"date_time"!==t.gridGroupBy[0].data_type&&"date"!==t.gridGroupBy[0].data_type&&"time"!==t.gridGroupBy[0].data_type?e.data[g][p]:t.groupDateSortName(t.gridGroupBy[0].dateType,e.data[g][p]),o=o.toString();var m=i("filter")(a,{value:o},!0)[0];if(!m){var f={field:p,value:o,items:[],hasSubgroups:!0},v=i("filter")(t.module.fields,{name:p.split(".")[0]},!0)[0],u=p.split(".");u.length>1&&(u=u[0]+"."+u[1]+".id");var c=e.data[g][u].toString();"currency"===v.data_type&&(c=c.slice(1)),t.gruopFilters.push({field:p.split(".")[0],value:c,operator:v.operators[0].name,no:1}),f.aggregates=t.aggregateParse(e,e.data[g][p],v),a.push(f)}}for(var w=t.gridGroupBy[1].field,y=0;y<e.data.length;y++){var h="";h=null===t.gridGroupBy[0].dateType||"date_time"!==t.gridGroupBy[0].data_type&&"date"!==t.gridGroupBy[0].data_type&&"time"!==t.gridGroupBy[0].data_type?e.data[y][p]:t.groupDateSortName(t.gridGroupBy[0].dateType,e.data[y][p]),h=h.toString();var b=i("filter")(a,{value:h},!0)[0];if(b){var _="";_=null===t.gridGroupBy[1].dateType||"date_time"!==t.gridGroupBy[1].data_type&&"date"!==t.gridGroupBy[1].data_type&&"time"!==t.gridGroupBy[1].data_type?e.data[y][w]:t.groupDateSortName(t.gridGroupBy[1].dateType,e.data[y][w]);var k=i("filter")(b.items,{value:_},!0)[0];if(k)k.items.push(e.data[y]);else{var V={field:w,value:_,items:[e.data[y]],hasSubgroups:!1,aggregates:{template:"",groupSelect:""}};b.items.push(V)}}}}return a},t.aggregateParse=function(a,r,l){var o={};if(t.gruopFilters.length>0&&"grid"===e.activeView.view_type&&e.activeView.aggregations&&a.aggregations&&a.aggregations.length>0){var n=i("filter")(a.aggregations,{group_value:r.toString()},!0)[0];if(!n)return;for(var s=0;s<n.fields.length;s++){var d=n.fields[s].split("::")[0],u=d.split(")")[0].split("("),c=n.data[d];if(null===c&&(c=0),Number.isInteger(c)||(c=parseFloat(c).toFixed(2)),l&&l.data_type&&"currency"===l.data_type){var p=l.currency_symbol?l.currency_symbol:null;p||(p="$"),"₺"===p?c+=p:c=p+c}o.template?o.template+=t.aggregationsParseText(u[0],n.label[s],c):o.template=t.aggregationsParseText(u[0],n.label[s],c)}}else o.template="";var g=i("filter")(a.groups_data,{group_value:r.toString()},!0)[0];if(g){var m=g.group_index,f=i("filter")(t.groupLastIdsArray,{value:r.toString()},!0)[0];if(!f){var v=a.groups_data[m].group_ids;t.groupLastIdsArray.push({value:r.toString(),ids:v})}return o.groupSelect="<input type='checkbox' ng-checked='isGroupSelected(\""+r+"\");' ng-click='selectGroups($event,\""+r+'","'+m+"\"); $event.stopPropagation();' class='k-checkbox header-checkbox mr-3'>",o}},t.groupDateSortName=function(e,t){var a="";if(""===t||null===t||void 0===t)return a;for(var i=t.match(/(\d+)/g),r=kendo.cultures.current.calendar.patterns.g.split(":")[0].split(/[.:\/\s,]+/),l={},o=0;o<r.length;o++)switch(r[o]){case"DD":case"dd":case"D":case"d":l.d=i[o];break;case"MM":case"mm":case"M":case"m":l.m=i[o];break;case"YYYY":case"yyyy":case"YY":case"yy":l.y=i[o];break;case"HH":case"H":case"hh":case"h":l.h=i[o]}switch(t="all"===e?new Date(l.y,l.m-1,l.d,l.h):new Date(l.y,l.m-1,l.d),e){case"year":a=l.y;break;case"ym":var n={year:"numeric",month:"long"};a=new Intl.DateTimeFormat(kendo.cultures.current.name,n).format(t);break;case"ymd":var n={year:"numeric",month:"long",weekday:"long",day:"numeric"};a=new Intl.DateTimeFormat(kendo.cultures.current.name,n).format(t);break;case"all":var n={year:"numeric",month:"long",weekday:"long",day:"numeric"};a=new Intl.DateTimeFormat(kendo.cultures.current.name,n).format(t)+", "+t.getHours()+":00-"+t.getHours()+":59"}return a},t.aggregationsParseText=function(e,t,a){var r="";switch(e){case"sum":r="<div class='ml-3 badge standart badge-secondary'>"+t+" ("+i("translate")("Report.sum")+"): <span>"+a+"</span></div>";break;case"avg":r="<div class='ml-3 badge standart badge-secondary'>"+t+" ("+i("translate")("Report.avg")+"): <span>"+a+"</span></div>";break;case"max":r="<div class='ml-3 badge standart badge-secondary'>"+t+" ("+i("translate")("Report.max")+"): <span>"+a+"</span></div>";break;case"min":r="<div class='ml-3 badge standart badge-secondary'>"+t+" ("+i("translate")("Report.min")+"): <span>"+a+"</span></div>";break;case"count":r="<div class='ml-3 badge standart badge-secondary'>"+t+": <span>"+a+"</span></div>"}return r},t.gridGroupFields=function(a){if("grid"===e.activeView.view_type&&t.gridGroupBy.length>0){for(var r=0;r<t.gridGroupBy.length;r++){var l=t.gridGroupBy[r].field;i("filter")(a,{name:l},!0)[0]||(t.gridGroupBy.splice(r,1),0===t.gridGroupBy.length&&(t.gridGroupBy=[]))}t.groupByFields=i("filter")(a,{data_type:"!multiselect_lookup"},!0)}},t.gridGroupLookupCheck=function(){if(t.gridGroupBy&&t.gridGroupBy.length>0)for(var e=0;e<t.gridGroupBy.length;e++)if(t.gridGroupBy[e].field.contains(".")){var a=t.gridGroupBy[e].field.split("."),r=i("filter")(t.module.fields,{name:a[0]},!0)[0];t.gridGroupBy[e].field=a[0]+"."+a[1]+"."+r.lookupModulePrimaryField.name,t.gridGroupBy[e].fieldArea=a[0]+"."+a[1]+"."+r.lookupModulePrimaryField.name}},t.aggregationsOrder=function(){var t=Object.assign([],e.activeView.aggregations),a=i("filter")(t,{aggregation_type:"count"},!0)[0],r=t.indexOf(a);t.splice(r,1),t.push(a),e.activeView.aggregations=t},t.gridGroupAggregationFields=function(a){if("grid"===e.activeView.view_type&&t.gridGroupBy.length>0){var r={label:i("translate")("Report.count"),aggregation_type:"count",field:"undefined",active:!1};null===e.activeView.aggregations&&(e.activeView.aggregations=[]);for(var l=0;l<e.activeView.aggregations.length;l++){var o=e.activeView.aggregations[l];if(!o){var n=e.activeView.aggregations.indexOf(o);e.activeView.aggregations.splice(n,1)}}for(var s=0;s<a.length;s++){var d=a[s];if(!("numeric"!==d.data_type&&"number"!==d.data_type&&"number_auto"!==d.data_type&&"currency"!==d.data_type&&"number_decimal"!==d.data_type||d.name.contains(".")||d.deleted)){if(e.activeView.aggregations&&e.activeView.aggregations.length>0)var u=i("filter")(e.activeView.aggregations,{field:d.name},!0)[0];u?u.label=d.label:e.activeView.aggregations.push({field:d.name,aggregation_type:"sum",active:!1,label:d.label})}}var c=i("filter")(e.activeView.aggregations,{aggregation_type:"count"},!0)[0];c?(c.label=i("translate")("Report.count"),c.field="undefined"):e.activeView.aggregations.push(r);for(var p=0;p<e.activeView.aggregations.length;p++){var g=e.activeView.aggregations[p];if(!i("filter")(a,{name:g.field},!0)[0]&&"count"!==g.aggregation_type){var m=e.activeView.aggregations.indexOf(g);e.activeView.aggregations.splice(m,1)}}}},t.switchChange=function(a){if(a){var r=i("filter")(e.activeView.aggregations,{field:a.field},!0)[0];r&&(r.active=a.active,r.aggregation_type=a.aggregation_type)}a.active===!0&&a.aggregation_type?t.changeAggregationType():a.active===!1&&t.changeAggregationType()},t.addGridGroup=function(){t.groupLastIdsArray=[];var e={};if(0===t.gridGroupBy.length)e.fieldArea=t.viewFields.selectedFields[0].name,e.field=t.viewFields.selectedFields[0].name,e.data_type=t.viewFields.selectedFields[0].data_type,e.dir="asc",("date"===e.data_type||"date_time"===e.data_type||"time"===e.data_type)&&(e.dateType="all",e.dateTypeArea="all");else if(t.viewFields.selectedFields.length>1){var a=1;t.gridGroupBy[0].field===t.viewFields.selectedFields[a].name&&(a=0),e.fieldArea=t.viewFields.selectedFields[a].name,e.field=t.viewFields.selectedFields[a].name,e.data_type=t.viewFields.selectedFields[a].data_type,e.dir="asc",("date"===e.data_type||"date_time"===e.data_type||"time"===e.data_type)&&(e.dateType="all",e.dateTypeArea="all")}Object.keys(e).length>0&&t.gridGroupBy.push(e),t.changeAggregationType()},t.changeGridGroupSort=function(e){e.dir="asc"===e.dir?"desc":"asc",t.changeAggregationType()},t.gridGroupDelete=function(e,a){if(t.groupLastIdsArray=[],a.splice(e,1),0===a.length){t.gridGroupBy=[];for(var i=0;i<t.activeView.aggregations.length;i++)t.activeView.aggregations[i].active=!1}t.changeAggregationType()},t.changeGridGroupField=function(e){var a=i("filter")(t.viewFields.selectedFields,{name:e.fieldArea},!0)[0];if(i("filter")(t.gridGroupBy,{field:a.name},!0)[0]){if(e.data_type=a.data_type,e.field=a.name,delete e.dateType,"date_time"===a.data_type||"time"===a.data_type)return t.loading=!0,t.gruopsForDateType=Object.assign([],t.gruopsForDateArea),e.dateType="all",void(e.dateTypeArea="all");if("date"===a.data_type)return t.loading=!0,t.gruopsForDateType=i("filter")(t.gruopsForDateArea,{isTime:!1},!0),e.dateType="year",void(e.dateTypeArea="year")}else{if(e.data_type=a.data_type,e.field=a.name,delete e.dateType,"date_time"===a.data_type||"time"===a.data_type)return t.gruopsForDateType=Object.assign([],t.gruopsForDateArea),e.dateType="all",e.dateTypeArea="all",void(t.loading=!0);if("date"===a.data_type)return t.gruopsForDateType=i("filter")(t.gruopsForDateArea,{isTime:!1},!0),e.dateType="year",e.dateTypeArea="year",void(t.loading=!0)}"date"===a.data_type||"date_time"===a.data_type||"time"===a.data_type?t.loading=!0:(delete e.dateType,t.changeAggregationType())},t.gruopsForDateArea=[{label:i("translate")("View.DateAll"),type:"all",isTime:!0},{label:i("translate")("View.DateYear"),type:"year",isTime:!1},{label:i("translate")("View.DateYM"),type:"ym",isTime:!1},{label:i("translate")("View.DateYMD"),type:"ymd",isTime:!1}],t.gruopsForDateType=Object.assign([],t.gruopsForDateArea),t.groupsForDate=function(a){var r=i("filter")(t.gruopsForDateArea,{type:a.dateTypeArea},!0)[0];a.dateType=r.type,e.globalLoading=!0},t.kanbanBoards=function(){t.boards=[];var a={id:0,label:i("translate")("View.Uncategorized")};t.picklistsModule&&e.activeView&&e.activeView.settings&&e.activeView.settings.kanbanPicklist&&(t.boards="picklist"===t.kanbanSelectPicklist.data_type?Object.assign([],t.picklistsModule[t.kanbanSelectPicklist.picklist_id]):Object.assign([],window.droplist[t.kanbanSelectPicklist.droplist_id].items),t.boards.unshift(a))},t.setViewKanban=function(){if(e.globalLoading=!0,f.getPicklists(t.module).then(function(a){e.processPicklistLanguages(a),t.picklistsModule=a}),t.boards=[],!(!t.kanbanSelectPicklist&&t.picklistFields&&t.picklistFields.length>0&&e.activeView.settings&&e.activeView.settings.kanbanPicklist)||(t.kanbanSelectPicklist=t.fieldskey[e.activeView.settings.kanbanPicklist],t.kanbanSelectPicklist))if(e.activeView.settings&&e.activeView.settings.kanbanPicklist){var a="kanban"===e.activeView.view_type?e.activeView:t.newGridData;t.changeView(a,!1),t.boards&&t.boards.length>0&&t.boards.forEach(function(e){t.kanbanListViewAltOptionsSet(e)})}else t.kanbanMainOptions=null},t.boardTemplateMain=function(){return"<div class='col'><div class='list-wrapper'>        <div class='list-header'>          <span class='list-title'>#: label #</span>        </div>        <div id='list-kanban-#: id #' kendo-list-view k-rebind='kanbanListViewAltOptions#: id #' k-options='kanbanListViewAltOptions#: id #' class='list'></div>      </div></div>"},t.getKanbanDataLenght=1,t.kanbanListViewAltOptionsSet=function(a){var i="kanbanListViewAltOptions"+a.id,r="kanbanFilter"+a.id,l={};t[r]=angular.copy(t.findRequestKanban),l=0===a.id?{field:t[r].picklist_name,operator:"empty",no:1,value:"-"}:{field:t[r].picklist_name,operator:"is",no:1,value:a.labelStr?a.labelStr:a.value||a.name},t[r].filters&&1===t[r].filters.length?(l.no=2,t[r].filters.push(l),t[r].filter_logic="(1 and 2)"):t[r].filters&&t[r].filters.length>1?(l.no=t[r].filters.length+1,t[r].filters.push(l),t[r].filter_logic="("+l.no+" and "+t[r].filter_logic+")"):(t[r].filters=[l],t[r].filter_logic=""),t[i]={theme:"default",template:function(e){var i="";return t.viewFields.selectedFields.forEach(function(t,a){if("multiselect_lookup"===t.data_type&&e[t.name]&&e[t.name].length>0){var r=e[t.name].map(function(e){return e.primary_value});e[t.name]=r.toString()}i+=0===a?"<div class='primary md-truncate'> <i class='fas fa-grip-vertical'></i>{{dataItem['"+t.name+"'] }}</div>":"<div class='others md-truncate'><span>"+t.label+":</span> <span class='label-data' ng-if='"+!!e[t.name]+"'> {{dataItem['"+t.name+"'] }}</span></div>"}),"<div id='kanban-sortable-"+e.id+"' name='"+a.id+"' class='card kanban-card' ng-click='goUrl2("+e.id+")'>"+i+"</div>"},dataSource:{serverPaging:!0,serverFiltering:!0,serverSorting:!0,pageSize:t.getItemCount,transport:{read:function(a){$.ajax({url:"/api/record/find_custom?locale="+C,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify(Object.assign(t[r],a.data)),success:function(i){i.data?a.success(i.data):$(".k-loading-mask").remove(),t.boards&&t.boards.length>0&&t.boards.length===t.getKanbanDataLenght?(t.kanbanSelectPicklist.validation&&t.kanbanSelectPicklist.validation.readonly||$(".list .k-listview-content").kendoSortable(t.sortableKanbanOptions),t.getKanbanDataLenght=1,t.loading=!1,e.globalLoading=!1):t.getKanbanDataLenght+=1},beforeSend:e.beforeSend()})}},schema:{id:"id"}}},t["scrollData"+a.id]=new kendo.data.DataSource({serverPaging:!0,serverFiltering:!0,serverSorting:!0,pageSize:t.getItemCount,transport:{read:function(a){$.ajax({url:"/api/record/find_custom?locale="+C,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify(Object.assign(t[r],a.data)),success:function(i){i.data&&a.success(i.data),t.loading=!1,e.globalLoading=!1},beforeSend:e.beforeSend()})}},schema:{total:"total",id:"id"}}),k(function(){t["page"+a.id]=1,t["scroll"+a.id]=!0,$("#list-kanban-"+a.id+" .k-listview-content").on("scroll",function(){if($(this).scrollTop()+$(this).innerHeight()+25*$(this)[0].scrollHeight/100>=$(this)[0].scrollHeight&&t["scroll"+a.id]||$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&t["scroll"+a.id]){t["scroll"+a.id]=!1,t["page"+a.id]++;var e=$("#list-kanban-"+a.id),i=e.data("kendoListView");t["scrollData"+a.id].query({page:t["page"+a.id],pageSize:t.getItemCount}).then(function(){var e=t["scrollData"+a.id].data();if(e.length>0){for(var r=0;r<e.length;r++)i.dataSource.pushCreate(e[r]);t["scroll"+a.id]=!0}})}})},800)},t.showModuleFrameModal=function(e){var t,a,i;t="myPop1",a=document.body.offsetWidth-200,i=document.body.offsetHeight-200;var r=screen.width/2-a/2,l=screen.height/2-i/2;window.open(e,t,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+a+", height="+i+", top="+l+", left="+r)},t.trustAsHtml=function(e){return a.trustAsHtml(e)},t.webhookRequest=function(a){if(!t.selectedRows||t.selectedRows.length<1)return void h.warning(i("translate")("Module.NoRecordSelected"));var r=t.actionButtons[a],l=r.parameters.split(","),o=r.headers.split(",");t.webhookRequesting={},t.webhookRequesting[r.id]=!0,f.getRecords(t.module.name,t.selectedRows).then(function(a){if(!a||!a.data||a.data.length<1)return void h.error(i("translate")("Common.NotFoundRecord"));for(var n=0;n<a.data.length;n++){var s={},d={"Content-Type":"application/json"},u=f.processRecordSingle(a.data[n],t.module,t.modulePicklists);if(angular.forEach(l,function(e){var a=e.split("|"),i=a[0],r=a[1],l=a[2];s[i]=r!==t.module.name?u[r]?u[r][l]:null:u[l]?u[l]:null}),angular.forEach(o,function(a){var i=a.split("|"),r=i[0],l=i[1],o=i[2],n=i[3];switch(r){case"module":var s=n;d[o]=l!==t.module.name?u[l]?u[l][s]:null:u[s]?u[s]:null;break;case"static":switch(n){case"{:app:}":d[o]=e.user.app_id;break;case"{:tenant:}":d[o]=e.user.tenant_id;break;case"{:user:}":d[o]=e.user.id;break;default:d[o]=null}break;case"custom":d[o]=n;break;default:d[o]=null}}),"post"===r.method_type)v.post(r.url,s,{headers:d}).then(function(){t.webhookRequesting[r.id]=!1})["catch"](function(){h.warning(i("translate")("Module.ActionButtonWebhookFail")),t.webhookRequesting[r.id]=!1});else if("get"===r.method_type){var c="";for(var p in s)c+=p+"="+s[p]+"&";c.length>0&&(c=c.substring(0,c.length-1)),v.get(r.url+"?"+c).then(function(){t.webhookRequesting[r.id]=!1})["catch"](function(){h.warning(i("translate")("Module.ActionButtonWebhookFail")),t.webhookRequesting[r.id]=!1})}}h.success(i("translate")("Module.ActionButtonWebhookSuccess"))})},t.runMicroflow=function(a,r){var l=t.actionButtons[r];if(0===t.selectedRows.length&&l.record_name)return void h.error(i("translate")("Module.RequiredRecord"));if(t.buttonsParametersData={},t.actionButtonsData={data:{module_id:t.module.id,is_array:l.is_array&&l.is_array},workflow_id:a,button:l},l.record_name&&(t.actionButtonsData.data.record_name=l.record_name,t.actionButtonsData.data.record_ids=t.selectedRows),l.parameters){t.picklistLang||(t.picklistLang=i("filter")(e.globalizations,function(e){return e.Culture.split("-")[0]===tenantLanguage?e:void 0})[0]),t.showMicroflowParameters=!0,t.showScriptParameters=!1,t.buttonParameterNameTitle=e.getLanguageValue(l.languages,"label"),t.buttonsParameters=JSON.parse(l.parameters),t.buttonsLanguages=l.languages,t.picklistItems={},angular.forEach(t.buttonsParameters,function(a){(3===a.type||4===a.type)&&v.get(p.apiUrl+"picklist/get/"+a.lowerType).then(function(i){t.picklistItems[a.key]=i.data,e.processLanguage(t.picklistItems)})});var o=angular.element(document.body);b.show({parent:o,templateUrl:"view/app/module/actionButtonsParameterModal.html",clickOutsideToClose:!0,scope:t,preserveScope:!0})}else t.actionButtonAfterClick(),f.runMicroflow(a,t.actionButtonsData.data).then(function(){t.actionButtonShowMessage(),t.selectedRows=[],t.selectedGroups=[],t.groupLastIdsArray=[],t.selectedRecords=[],t.isAllSelected=!1,t.actionButtonsData&&t.actionButtonsData.data&&(t.actionButtonsData.data.record_ids=[])})["catch"](function(e){400===e.status&&h.error(i("translate")("Module.RequiredRecord"))})},t.runMicroflowParameters=function(e){e.validate()&&(t.actionButtonAfterClick(),t.actionButtonsData.data.parameters=t.buttonsParametersData,f.runMicroflow(t.actionButtonsData.workflow_id,t.actionButtonsData.data).then(function(){t.actionButtonShowMessage(),t.selectedRows=[],t.selectedGroups=[],t.groupLastIdsArray=[],t.selectedRecords=[],t.isAllSelected=!1,t.actionButtonsData&&t.actionButtonsData.data&&(t.actionButtonsData.data.record_ids=[])})["catch"](function(e){400===e.status&&h.error(i("translate")("Module.RequiredRecord"))}),t.closeLightBox())},t.numberOptionsButtons={format:"{0:n0}",decimals:0},t.actionButtonShowMessage=function(){t.actionButtonsData.button.delay||(t.actionButtonsData.button.delay=0),k(function(){var a=e.getLanguageValue(t.actionButtonsData.button.languages,"message");"popup"===t.actionButtonsData.button.message_type&&a&&h.success(a)},1e3*t.actionButtonsData.button.delay)},t.actionButtonAfterClick=function(){t.actionButtonsData&&t.actionButtonsData.button&&(t.actionButtonsData.button.delay?t.actionButtonsData.button.delay>0&&S.start(i("translate")("Common.PleaseWait")):t.actionButtonsData.button.delay=0,t.actionButtonGlobalLoading=!0,"stay_page"!==t.actionButtonsData.button.action_after_click&&""!==t.actionButtonsData.button.action_after_click&&t.actionButtonsData.button.action_after_click?"refresh_page"===t.actionButtonsData.button.action_after_click?0===t.actionButtonsData.button.delay?(t.actionButtonGlobalLoading=!1,S.stop(),t.buttonRefreshAction()):(t["disableButton"+t.actionButtonsData.button.id]=!0,k(function(){t["disableButton"+t.actionButtonsData.button.id]=!1,t.actionButtonGlobalLoading=!1,S.stop(),t.buttonRefreshAction()},1e3*t.actionButtonsData.button.delay)):"go_list"===t.actionButtonsData.button.action_after_click&&(0===t.actionButtonsData.button.delay?(t.actionButtonGlobalLoading=!1,S.stop(),t.buttonRefreshAction()):(t["disableButton"+t.actionButtonsData.button.id]=!0,k(function(){t["disableButton"+t.actionButtonsData.button.id]=!1,t.actionButtonGlobalLoading=!1,S.stop(),t.buttonRefreshAction()},1e3*t.actionButtonsData.button.delay))):0===t.actionButtonsData.button.delay?(t.actionButtonGlobalLoading=!1,S.stop()):(t["disableButton"+t.actionButtonsData.button.id]=!0,k(function(){t["disableButton"+t.actionButtonsData.button.id]=!1,t.actionButtonGlobalLoading=!1,S.stop()},1e3*t.actionButtonsData.button.delay)))},t.buttonRefreshAction=function(){"grid"===e.activeView.view_type||"report"===e.activeView.view_type&&"tabular"===e.activeView.report_type?t.refreshGrid():"kanban"===e.activeView.view_type?$("#board").data("kendoListView").dataSource.read():"calendar"===e.activeView.view_type&&t.refreshViewCalendar()},t.recordDelete=function(e,a){var r=b.confirm().title(i("translate")("Common.AreYouSure")).targetEvent(e).ok(i("translate")("Common.Yes")).cancel(i("translate")("Common.No"));b.show(r).then(function(){f.getRecord(t.module.name,a).then(function(e){if(!t.hasPermission(t.type,m.remove,e.data))return void h.error(i("translate")("Common.Forbidden"));var r=f.processRecordSingle(e.data,t.module,t.modulePicklists);t.executeCode=!1,w.run("BeforeDelete","Script",t,r),t.executeCode||f.deleteRecord(t.module.name,a).then(function(){t.refreshGrid(),h.success(i("translate")("Module.DeleteMessage"))})})},function(){t.status="You decided to keep your debt."})},t.hideCreateNew=function(e){return"users"===e.lookup_type?!0:"relation"===e.lookup_type&&!t.record.related_module},t.deleteView=function(a){var r=b.confirm().title(i("translate")("Common.AreYouSure")).targetEvent(a).ok(i("translate")("Common.Yes")).cancel(i("translate")("Common.No"));b.show(r).then(function(){f.deleteView(e.activeView.id).then(function(){h.success({content:i("translate")("View.DeleteSuccess"),timeout:5e3}),t.closeLightBox(),c.remove(t.module.name+"-activeView"),f.getViews(t.module).then(function(a){e.processLanguages(a),t.views=a,t.views.reverse(),e.activeView=null;var r=i("filter")(t.views,{"default":!0},!0)[0]||t.views[0];e.closeSide("sideModal"),t.setView(r),0===t.views.length&&(window.location="#/app/modules/"+t.module.name)})})},function(){t.status="You decided to keep your debt."})},t["export"]=function(){if(!(t.tableParams.total()<1)){var a=!1;try{a=!!new Blob}catch(r){}if(!a)return void h.warning({content:i("translate")("Module.ExportUnsupported"),timeout:8e3});if(t.tableParams.total()>3e3)return void h.warning({content:i("translate")("Module.ExportWarning"),timeout:8e3});var l=e.getLanguageValue(t.module.languages,"label","plural")+"-"+i("date")(new Date,"dd-MM-yyyy")+".xls";t.exporting=!0,f.getCSVData(t,t.type).then(function(e){h.success({content:i("translate")("Module.ExcelExportSuccess"),timeout:5e3}),g.excel(e,l),t.exporting=!1})}},t.showActivityButtons=function(){},t.showDataTransferButtons=function(){},t.openExportDialog=function(){t.pdfCreating=!0,t.loadingModal=!0;var a=function(){var e=angular.element(document.body);b.show({parent:e,templateUrl:"view/app/module/modulePdfModal.html",clickOutsideToClose:!1,scope:t,preserveScope:!0})
};f.getTemplates(t.module.name,"module").then(function(r){if(0===r.data.length)h.warning(e.preview?i("translate")("Setup.Templates.TemplateDefined"):i("translate")("Setup.Templates.TemplateNotFound")),t.pdfCreating=!1;else{var l=r.data;t.quoteTemplates=i("filter")(l,{active:!0},!0),t.isShownWarning=!0;for(var o=0;o<t.quoteTemplates.length;o++){var n=t.quoteTemplates[o];if(n.permissions.length>0){var s=i("filter")(n.permissions,{profile_id:e.user.profile.id},!0)[0];n.isShown="none"===s.type?!1:!0,n.isShown===!0&&(t.isShownWarning=!1)}else n.isShown=!0,t.isShownWarning=!1}t.quoteTemplatesOptions={dataSource:i("filter")(t.quoteTemplates,{isShown:!0},!0),dataTextField:"name",dataValueField:"id"},t.quoteTemplate=t.quoteTemplates[0],t.loadingModal=!1,a()}})["catch"](function(){t.pdfCreating=!1})},t.selectRow=function(e,a){return e.target.checked?(a.selected=!0,t.selectedRows.push(a.id),void t.selectedRecords.push({id:a.id,displayName:a[t.module.primaryField.name]})):(a.selected=!1,t.selectedRows=t.selectedRows.filter(function(e){return e!==a.id}),t.selectedRecords=t.selectedRecords.filter(function(e){return e.id!==a.id}),void(t.isAllSelected=!1))},t.isRowSelected=function(e){return t.selectedRows.filter(function(t){return t===e}).length>0},t.isGroupSelected=function(e){return t.isAllSelected?!1:t.selectedGroups.filter(function(t){return t.value===e}).length>0},t.selectGroups=function(e,a,r){r=parseInt(r),t.isAllSelected=!1;for(var l=$("#kendo-grid").data("kendoGrid").dataSource.data(),o=0;o<l.length;o++)if(o===r){var n=i("filter")(t.groupLastIdsArray,{value:a.toString()},!0)[0];if(e.target.checked){t.selectedGroups.push({value:a,groupIds:n.ids});for(var s=0;s<n.ids.length;s++)if(!t.selectedRows.includes(n.ids[s].id)){var d=i("filter")(t.records,{id:n.ids[s].id},!0)[0];n.ids[s][t.module.primaryField.name]=void 0===d?n.ids[s].id:d[t.module.primaryField.name],t.selectRow(e,n.ids[s])}}else{for(var u=0;u<n.ids.length;u++){var c=t.selectedRows.indexOf(n.ids[u].id);t.selectedRows.splice(c,1),t.selectedRecords=t.selectedRecords.filter(function(e){return e.id!==n.ids[u].id})}t.selectedGroups=t.selectedGroups.filter(function(e){return e.value!==a})}}for(var p=0;p<l.length;p++)if(l[p].hasSubgroups)for(var g=0;g<l[p].items.length;g++)for(var m=0;m<l[p].items[g].items.length;m++)p===r&&(e.target.checked?(!l[p].items[g].items[m].freeze||t.user.profile.has_admin_rights)&&(t.selectedRows.includes(l[p].items[g].items[m].id)||(l[p].items[g].items[m].selected=!0)):l[p].items[g].items[m].selected=!1);else for(var g=0;g<l[p].items.length;g++)p===r&&(e.target.checked?(!l[p].items[g].freeze||t.user.profile.has_admin_rights)&&(t.selectedRows.includes(l[p].items[g].id)||(l[p].items[g].selected=!0)):l[p].items[g].selected=!1)},t.selectAll=function(e,a){if(t.selectedRows=[],t.selectedGroups=[],t.isAllSelected){t.isAllSelected=!1;for(var i=0;i<a.length;i++)if(a[i].items)for(var r=0;r<a[i].items.length;r++)if(a[i].items[r].items)for(var l=0;l<a[i].items[r].items.length;l++)a[i].items[r].items[l].selected&&(a[i].items[r].items[l].selected=!1);else a[i].items[r].selected&&(a[i].items[r].selected=!1);else a[i].selected&&(a[i].selected=!1)}else{t.isAllSelected=!0;for(var i=0;i<a.length;i++)if(a[i].items)for(var r=0;r<a[i].items.length;r++)if(a[i].items[r].items)for(var l=0;l<a[i].items[r].items.length;l++)!a[i].items[r].items[l].freeze||t.user.profile.has_admin_rights?(a[i].items[r].items[l].selected=!0,t.selectRow(e,a[i].items[r].items[l])):a[i].items[r].items[l].selected=!1;else!a[i].items[r].freeze||t.user.profile.has_admin_rights?(a[i].items[r].selected=!0,t.selectRow(e,a[i].items[r])):a[i].items[r].selected=!1;else!a[i].freeze||t.user.profile.has_admin_rights?(a[i].selected=!0,t.selectRow(e,a[i])):a[i].selected=!1}},t.deleteSelecteds=function(e){if(!t.selectedRows||!t.selectedRows.length)return void h.warning(i("translate")("Module.NoRecordSelected"));var a=b.confirm().title(i("translate")("Common.AreYouSure")).textContent(i("translate")("Module.SelectedRecordsCount")+t.selectedRows.length).targetEvent(e).ok(i("translate")("Common.Yes")).cancel(i("translate")("Common.No"));b.show(a).then(function(){f.deleteRecordBulk(t.module.name,t.selectedRows).then(function(){h.success(i("translate")("Module.DeleteMessage")),t.selectedRows=[],t.selectedGroups=[],t.isAllSelected=!1,t.refreshGrid()})},function(){t.status="You decided to keep your debt."})},t.addCustomField=function(e,t){tinymce.activeEditor.execCommand("mceInsertContent",!1,"{"+t.name+"}")},t.showEMailModal=function(){if(t.executeCode=!1,!e.system.messaging.SystemEMail&&!e.system.messaging.PersonalEMail)return void h.warning(i("translate")("EMail.NoProvider"));if(0==t.selectedRows.length&&!t.isAllSelected)return void h.warning(i("translate")("Module.NoRecordSelected"));w.run("BeforeModalLoad","Script",t);var a=angular.element(document.body);t.executeCode||b.show({parent:a,templateUrl:"view/app/email/bulkEMailModal.html",clickOutsideToClose:!1,scope:t,preserveScope:!0})},t.showSMSModal=function(){if(!e.system.messaging.SMS)return void h.warning(i("translate")("SMS.NoProvider"));if(0==t.selectedRows.length&&!t.isAllSelected)return void h.warning(i("translate")("Module.NoRecordSelected"));var a=angular.element(document.body);b.show({parent:a,templateUrl:"view/app/sms/bulkSMSModal.html",clickOutsideToClose:!1,scope:t,preserveScope:!0})},t.collectiveApproval=function(){t.loading=!0,e.globalLoading=!0;var a=[];angular.forEach(t.selectedRows,function(e){var r=i("filter")(t.grid.dataSource.data(),{id:e},!0)[0];angular.isUndefined(r)||2!==r["process.process_requests.process_status"]&&a.push(r.id)}),a.length>0&&f.approveMultipleProcessRequest(a,t.module.name).then(function(){h.success(a.length+i("translate")("Module.ApprovedRecordCount")),t.loading=!1,e.globalLoading=!1,t.refresh(!0)})},t.showCollectiveApproval=function(){t.selected=t.selectedRows.length,!t.selectedRows||t.selectedRows.length>0||h.warning(i("translate")("Module.NoRecordSelected"))},t.dropdownHide=function(){var e=angular.element(document.getElementById("dropdownMenu1"));e[0]&&e[0].click(),e[1]&&e[1].click()},t.closeLightBox=function(){b.hide()},t.showLightBox=function(a,r,l,o,n){if(r){t.showImageData={},t.multiSelectAndTagDatas={};var s=n?e.modulus[n.related_module]:t.module,d=o?i("filter")(s.fields,{name:o,deleted:!1})[0]:t.module.primaryField.name;l?t.showImageData={url:a.target.src,title:r[d]||e.getLanguageValue(d.languages,"label"),type:o?"location":"image",map_url:"http://www.google.com/maps/place/"+r[d.name]}:r[o]&&(d=i("filter")(s.fields,{name:o,deleted:!1})[0],t.multiSelectAndTagDatas={array:r[o].split(";"),title:r[d]||e.getLanguageValue(d.languages,"label")}),b.show({contentElement:"#mdLightbox",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:!1})}},t.setCurrentLookupField=function(){};var J=function(){if("users"===t.field.lookup_type&&!t.field.lookupModulePrimaryField){var a={};a.data_type="text_single",a.name="full_name",t.field.lookupModulePrimaryField=a}if("profiles"===t.field.lookup_type&&!t.field.lookupModulePrimaryField){var a={};a.data_type="text_single",a.name="name",t.field.lookupModulePrimaryField=a}if("roles"===t.field.lookup_type&&!t.field.lookupModulePrimaryField){var a={};a.data_type="text_single",a.name="label_"+e.user.tenantLanguage,t.field.lookupModulePrimaryField=a}if("relation"===t.field.lookup_type){if(!t.record.related_module)return s.defer().promise;var r=i("filter")(e.modules,{name:t.record.related_module.value},!0)[0];if(!r)return s.defer().promise;t.field.lookupModulePrimaryField=i("filter")(r.fields,{primary:!0},!0)[0]}};t.inputReset=function(){if(t.bulkUpdate={},t.bulkUpdate.value=null,"picklist"===t.field.data_type&&(t.optionId=t.field.picklist_id),"checkbox"===t.field.data_type&&(t.bulkUpdate.value=!1),"lookup"===t.field.data_type){t.currentLookupField=null,t.currentLookupField=t.field,t.optionsFilter=null;var a=new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(a){var i={module:t.currentLookupField.lookup_type,convert:!1,is_search:!1,field_name:t.currentLookupField.name};if((!a.data.filter||a.data.filter&&0===a.data.filter.filters.length)&&(a.data.filter={},a.data.filter.filters=[],a.data.filter.logic="and",J()),a.data.filter.filters.length>0){t.optionsFilter=a.data.filter.filters,i.is_search=!!a.data.filter.filters[0].value;var r=a.data.filter.filters[0].operator;r.contains("_")&&(a.data.filter.filters[0].operator=""!==r?r.replace("_",""):"startswith"),t.lookupSearchValue=a.data.filter.filters[0].value}null!=t.optionsFilter&&t.optionsFilter.length>0&&(a.data.filter.filters=t.optionsFilter),$.ajax({url:"/api/record/find_custom",contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify(Object.assign(i,a.data)),success:function(e){a.success(e)},beforeSend:e.beforeSend()})}},schema:{data:"data",total:"total",model:{id:"id"}}});t["lookupOptions"+t.field.id]={dataSource:a,optionLabel:i("translate")("Common.Select"),dataTextField:t.field.lookupModulePrimaryField.name,dataValueField:"id"};var r=angular.element(document.getElementById(t.field.name)).data("kendoDropDownList");r&&(r.setOptions({dataTextField:t.field.lookupModulePrimaryField.name}),r.setDataSource(a))}},t.updateSelected=function(e){if(t.selectedRows&&t.selectedRows.length&&e.validate()){t.submittingModal=!0;var a={},r=t.field.name;a.ids=t.selectedRows;var l={};if(a.records=[],"picklist"!==t.field.data_type&&"droplist"!==t.field.data_type&&"multiselect"!==t.field.data_type&&"multiselect_droplist"!==t.field.data_type&&"date"!==t.field.data_type&&"tag"!==t.field.data_type)l[r]=t.bulkUpdate.value;else switch(t.field.data_type){case"picklist":l[r]=t.bulkUpdate.value.id;break;case"droplist":l[r]=t.bulkUpdate.value.name;break;case"multiselect":for(var o=[],n=0;n<t.bulkUpdate.value.length;n++)o.push(t.bulkUpdate.value[n].id);l[r]=o;break;case"multiselect_droplist":for(var s=[],n=0;n<t.bulkUpdate.value.length;n++)s.push(t.bulkUpdate.value[n].name);l[r]=s;break;case"tag":for(var d=[],u=0;u<t.bulkUpdate.value.length;u++){var c=i("filter")(t.field.tag.dataSource._view,{id:parseInt(t.bulkUpdate.value[u])},!0)[0];c&&d.push(c.text)}l[r]=d.toString();break;case"date":var p=moment(t.bulkUpdate.value).format().split("+");l[r]=p[0]}a.records.push(l),t.closeLightBox(),S.start(i("translate")("Common.PleaseWait")),f.updateRecordBulk(t.module.name,a).then(function(){S.stop(),h.success(i("translate")("Module.UpdateRecordBulkSuccess")),t.refreshGrid(),t.isAllSelected=!1,t.selectedRows=[],t.selectedGroups=[],t.selectedRecords=[],t.bulkUpdate={},t.bulkUpdate.value=null,t.bulkUpdate.valueStr=null,t.field=null})["catch"](function(){S.stop(),t.bulkUpdate={},t.bulkUpdate.value=null,t.bulkUpdate.valueStr=null,t.field=null})}},t.openCalendar=function(e){f.openCalendar(e)},t.openExcelTemplate=function(){t.excelCreating=!0,t.hasQuoteTemplateDisplayPermission=f.hasQuoteTemplateDisplayPermission;var a=function(){var e=angular.element(document.body);b.show({parent:e,templateUrl:"view/app/module/moduleExcelModal.html",clickOutsideToClose:!1,scope:t,preserveScope:!0})};t.quoteTemplates&&(a(),t.quoteTemplate=t.quoteTemplates[0]),f.getTemplates(t.module.name,"excel").then(function(r){if(0===r.data.length)h.warning(e.preview?i("translate")("Setup.Templates.TemplateDefined"):i("translate")("Setup.Templates.TemplateNotFound")),t.excelCreating=!1;else{var l=r.data;t.quoteTemplates=i("filter")(l,{active:!0},!0),t.isShownWarning=!0;for(var o=0;o<t.quoteTemplates.length;o++){var n=t.quoteTemplates[o];"everybody"===n.sharing_type?n.isShown=!0:"me"===n.sharing_type?n.isShown=n.created_by_id===e.user.id:"profile"===n.sharing_type&&(n.isShown=n.profile_list[e.user.profile.id]),n.isShown===!0&&(t.isShownWarning=!1)}t.quoteTemplate=t.quoteTemplates[0],a()}})["catch"](function(){t.excelCreating=!1})},t.UpdateMultiselect=function(a,i){var r=[];return angular.forEach(t.modulePicklists[i.picklist_id],function(t){if(!t.inactive){var i=e.getLanguageValue(t.languages,"label");i&&i.toLowerCase().indexOf(a)>-1&&r.push(t)}}),r},f.getPicklists(t.module,!0).then(function(a){var r=Object.assign({},t.sharesOptions),l={dataSource:[{label:i("translate")("Common.CheckboxYes"),value:!0},{label:i("translate")("Common.CheckboxNo"),value:!1}],filter:"contains",dataTextField:"label",dataValueField:"value",optionLabel:i("translate")("Common.Select")};r.dataSource.push({full_name:i("translate")("Common.LoggedInUser"),id:"[me]"}),e.processPicklistLanguages(a),t.modulePicklists=a,t.picklistOptions=[];for(var o=0;o<t.allFields.length;o++){var n=t.fieldskey[t.allFields[o].name];switch(n.data_type){case"picklist":"picklist"!==n.data_type||n.deleted||(n.picklist=i("filter")(t.modulePicklists[n.picklist_id],function(e){return t.componentFilter={},t.componentFilter.item=e,t.componentFilter.result=!0,w.run("PicklistFilter","Script",t),!e.inactive&&t.componentFilter.result},!0));break;case"droplist":"droplist"!==n.data_type||n.deleted||(n.droplist=i("filter")(window.droplist[n.droplist_id].items,function(e){return t.componentFilter={},t.componentFilter.item=e,t.componentFilter.result=!0,w.run("DroplistFilter","Script",t),!e.inactive&&t.componentFilter.result},!0));break;case"multiselect":n.options={dataSource:t.modulePicklists[n.picklist_id],filter:"contains",dataTextField:"languages."+e.globalization.Label+".label",dataValueField:"id",optionLabel:i("translate")("Common.Select")};break;case"multiselect_droplist":n.options={dataSource:window.droplist[n.droplist_id].items,filter:"contains",dataTextField:"label",dataValueField:"name",optionLabel:i("translate")("Common.Select")};break;case"tag":var s=new kendo.data.DataSource({transport:{read:{url:"/api/tag/get_tag/"+n.id,type:"GET",dataType:"json",beforeSend:e.beforeSend()}}});s.read(),n.tag={dataSource:s,dataTextField:"text",dataValueField:"id",valuePrimitive:!0,filter:"contains",tagMode:"multiple",change:function(){var e=this.value(),t=this.options.tagMode,a=t;a=e.length<=5?"multiple":"single",a!==t&&(this.value([]),this.setOptions({tagMode:a}),this.value(e))}};break;case"lookup":"users"===n.lookup_type&&(n.dataOptions=r);break;case"checkbox":n.options=l;break;case"date":case"date_time":case"time":}}}),t.showUpdateModal=function(a){if(t.bulkUpdate={},t.bulkUpdate.value=null,t.bulkUpdate.valueStr=null,t.field=null,!t.selectedRows||!t.selectedRows.length)return void h.warning(i("translate")("Module.NoRecordSelected"));if(t.selectedRows.length>100)return void h.warning(i("translate")("Module.RecordLimit"));var r=[],l=function(){if(r=angular.copy(t.module.fields),!t.isAdmin&&!t.hasBulkUpdatePermission){for(var e=0;e<t.module.sections.length;e++){var a=t.module.sections[e];f.hasSectionFullPermission(a)&&f.hasSectionDisplayPermission(a)&&!f.hasSectionReadOnlyPermission(a)||(r=i("filter")(r,function(e){return e.section!==a.name},!0))}for(var e=0;e<r.length;e++)if(!f.hasFieldFullPermission(r[e])||!f.hasFieldDisplayPermission(r[e])||f.hasFieldReadOnlyPermission(r[e])){var l=r.indexOf(r[e]);r.splice(l,1)}}};l(),t.fieldOptions={dataSource:i("filter")(r,function(e){return e.display_list?("number"!==e.data_type||e.deleted?"number_decimal"!==e.data_type||e.deleted?"currency"!==e.data_type||e.deleted||(e=f.setMinMaxValueForField(e),t["currencyOptions"+e.id]={culture:kendo.cultures.current.name,format:"c",decimals:kendo.cultures.current.numberFormat.currency.decimals}):e=f.setMinMaxValueForField(e):(e=f.setMinMaxValueForField(e),t["numberOptions"+e.id]={format:"{0:n0}",decimals:0}),!("checkbox"===e.data_type&&!preview&&"is_sample"===e.name||"image"===e.data_type||"location"===e.data_type||"document"===e.data_type||"number_auto"===e.data_type||"updated_at"===e.name||"updated_by"===e.name||"created_at"===e.name||"created_by"===e.name||!e.validation||e.validation.readonly||e.custom_label)):void 0},!0),dataTextField:"languages."+e.globalization.Label+".label",dataValueField:"id",autoBind:!1,filter:"contains",optionLabel:i("translate")("Common.Select")},t.picklistsModule&&f.getPicklists(t.module).then(function(a){e.processPicklistLanguages(a),t.picklistsModule=a}),t.selected=t.selectedRows.length;var o=angular.element(document.body);b.show({parent:o,templateUrl:"view/app/module/bulkUpdateModal.html",clickOutsideToClose:!0,targetEvent:a,scope:t,preserveScope:!0}),k(function(){angular.element(document).ready(function(){t.bulkUpdateModalForm.options.rules.range=f.rangeRuleForForms()})},200)},t.showDeleteModal=function(){t.selected=t.selectedRows.length},t.showExportDataModal=function(e){t["export"].moduleAllColumn=null;var a=angular.element(document.body);b.show({parent:a,templateUrl:"view/app/module/exportData.html",clickOutsideToClose:!1,targetEvent:e,scope:t,preserveScope:!0})},t.recordProcessDetail=function(a){t.previousApprovers&&delete t.previousApprovers,t.processOrderParam&&delete t.processOrderParam,t.currentApprover&&delete t.currentApprover,t.updateTime&&delete t.updateTime,t.rejectApprover&&delete t.rejectApprover;var r;"dynamicApprover"===r.approver_type&&(t.loadingProcessPopup=!0,t.processStatusParam=a["process.process_requests.process_status"],f.getRecord(t.module.name,a.id).then(function(a){var r,l,o,n,s=a.data,d=[];if(1===s.process_status){if(r=s.process_status_order,1===s.process_status_order)l=i("filter")(e.users,{email:s.custom_approver},!0)[0].full_name;else{l=i("filter")(e.users,{email:s["custom_approver_"+s.process_status_order]},!0)[0].full_name;var u=i("filter")(e.users,{email:s.custom_approver},!0)[0].full_name;d.push(u);for(var c=2;c<s.process_status_order;c++)d.push(i("filter")(e.users,{email:s["custom_approver_"+c]},!0)[0].full_name);t.previousApprovers=d}t.processOrderParam=r,t.currentApprover=l}else if(2===s.process_status){o=s.process_request_updated_at;var u=i("filter")(e.users,{email:s.custom_approver},!0)[0].full_name;d.push(u);for(var c=2;c<s.process_status_order+1;c++)d.push(i("filter")(e.users,{email:s["custom_approver_"+c]},!0)[0].full_name);t.previousApprovers=d,t.updateTime=moment(o).utc().format("DD-MM-YYYY HH:mm")}else 3===s.process_status&&(o=s.process_request_updated_at,n=i("filter")(e.users,{id:s.process_request_updated_by},!0)[0].full_name,t.rejectApprover=n,t.updateTime=moment(o).utc().format("DD-MM-YYYY HH:mm"));t.loadingProcessPopup=!1}))},t.filterModalOpen=function(){e.buildToggler("sideModal","view/app/module/filter-view.html"),setTimeout(function(){var t=$("#available-fields").data("kendoListBox");if(t)for(O=0;t.options.dataSource.length>O;O++)t.options.dataSource[O].name.includes("seperator-")&&t.enable($(".k-item").eq(O),!1);else e.isDocked&&setTimeout(function(){if(t=$("#available-fields").data("kendoListBox"))for(O=0;t.options.dataSource.length>O;O++)t.options.dataSource[O].name.includes("seperator-")&&t.enable($(".k-item").eq(O),!1)},400)},300),e.isViewFilterOpen||(e.isViewFilterOpen=!0,u.write("is_view_open",e.isViewFilterOpen))},t.refreshGrid=function(){$("#kendo-grid").data("kendoGrid").dataSource.read()},t.goToRecord=function(e,t,a,i,r){f.goToRecord(e,t,a,i,r)},t.goToMultiselectLookupRecord=function(e,t,a,i,r){f.goToMultiselectLookupRecord(e,t,a,i,r)},t.getTagAndMultiDatas=function(e,t){if(e[t]){var a=e[t].split(";");return f.getTagAndMultiDatas(e,a)}},t.getMultiTextData=function(e,t){var a=e.length;return a>20?(e=e.substring(0,20)+"...",t.show=!0):t.show=!1,[e]},t.getImageStyle=function(e){return e?f.getImageStyle(e,t.module.name):void 0},t.getRatingCount=function(e){return e?f.getRatingCount(e,t.module.name):void 0},t.getLocationUrl=function(e){return e?f.getLocationUrl(e):void 0},t.newGridData={module_id:t.module.id,languages:{},active:!0,sharing_type:"everybody",isNew:!0,filter_logic_json:'{"group":{"logic":"and","filters":[],"level":1}}',"default":!0,view_type:"grid",report_feed:"module",report_type:"",sort_direction:"",filters:[],fields:[{field:t.module.primaryField.name,order:1}]},t.newGridData.languages[e.globalization.Label]={label:e.getLanguageValue(t.module.languages,"label","plural")},t.openNewDashlet=function(){t.views=[],t.activeView=angular.copy(t.newGridData),t.views.push(t.activeView),t.changeView(t.activeView),t.filterModalOpen()},t.changeTotalCount=function(a){t.totalCount=a,a&&(e.activeView.aggregation={aggregation_type:"count",field:"created_by"},e.activeView.aggregations[0]=e.activeView.aggregation,"summary"===e.activeView.report_type?t.chartFilter():t.widgetFilter())},t.setViewAggregationsFields=function(t){if("report"!==e.activeView.view_type)return!1;var a=[];if("tabular"===e.activeView.report_type){for(var r=0;r<t.length;r++){var l=t[r];if(("numeric"===l.data_type||"number"===l.data_type||"number_auto"===l.data_type||"currency"===l.data_type||"number_decimal"===l.data_type)&&!l.deleted){if(e.activeView.aggregations&&e.activeView.aggregations.length>0)var o=i("filter")(e.activeView.aggregations,{field:l.name})[0];a.push(o?o:{field:l.name,aggregation_type:""})}}e.activeView.aggregations=a}},t.controlRemove=function(e,a){return e.showRemove=t.hasPermission(a?a:t.module.name,m.remove)},t.controlCopy=function(e,a){return e.showCopy=t.hasPermission(a?a:t.module.name,m.write)},t.controlEdit=function(e,a){return e.showEdit=t.hasPermission(a?a:t.module.name,m.modify)},t.validSelectedFields=function(){return"view"===t.activeView.view_type||"tabular"===t.activeView.report_type?t.viewFields.selectedFields.length>=1:!0},t.runScript=function(a){var i=t.actionButtons[a];if(t.buttonsParametersData={},t.actionButtonsData={button:i},i.parameters){t.showMicroflowParameters=!1,t.showScriptParameters=!0,t.buttonParameterNameTitle=e.getLanguageValue(i.languages,"label"),t.buttonsParameters=JSON.parse(i.parameters),t.buttonsLanguages=i.languages,t.picklistItems={},angular.forEach(t.buttonsParameters,function(a){(3===a.type||4===a.type)&&v.get(p.apiUrl+"picklist/get/"+a.lowerType).then(function(i){t.picklistItems[a.key]=i.data,e.processLanguage(t.picklistItems)})});var r=angular.element(document.body);b.show({parent:r,templateUrl:"view/app/module/actionButtonsParameterModal.html",clickOutsideToClose:!0,scope:t,preserveScope:!0})}else t.actionButtonAfterClick(),_.run(t,i.template),t.actionButtonShowMessage()},t.runScriptParameters=function(e){e.validate()&&(t.actionButtonAfterClick(),t.actionButtonsData.data.parameters=t.buttonsParametersData,_.run(t,t.actionButtonsData.button.template),t.actionButtonShowMessage(),t.closeLightBox())},t.shortChange=function(e,a){t.reportSummary.fieldName=e,t.reportSummary.reverse=a,t.reportSummary.data=i("orderBy")(t.reportSummary.data,t.reportSummary.fieldName,t.reportSummary.reverse)},t.downloadImg=function(e){if(e){var t=e.split("/"),a=t[t.length-1];v({method:"GET",url:e,responseType:"arraybuffer"}).then(function(e){if(e.data){var t=new Uint8Array(e.data),i=new Blob([t],{type:"application/octet-stream"});saveAs(i,a)}},function(){})}},t.revertFilter=function(){var a=i("filter")(t.shadowViews,{id:e.activeView.id},!0)[0];t.setView(Object.assign({},a))},t.setViewCalendar=function(){return e.activeView.settings&&e.activeView.settings.startdatefield?(e.globalLoading=!0,t.findRequest={module:t.module.name,take:5e3,filter_logic:e.activeView.filter_logic,filters:e.activeView.filters,convert:!0,fields:[t.primaryField,e.activeView.settings.startdatefield]},t.enddateisAvailable=!1,t.checkFiltersExistLookupForCalender(),e.activeView.settings.enddatefield&&"end"!==e.activeView.settings.enddatefield?(t.findRequest.fields.push(e.activeView.settings.enddatefield),t.enddateisAvailable=!0):e.activeView.settings.enddatefield="end",t.calenderDefaultDate=new Date,t.calendarOptions={add:function(e){e.preventDefault()},edit:function(e){window.location="#/app/record/"+t.module.name+"?id="+e.event.id,e.preventDefault()},resize:function(t){return"end"===e.activeView.settings.enddatefield&&t.preventDefault(),!1},resizeEnd:function(e){return t.enddateisAvailable||e.preventDefault(),!1},navigate:function(e){return e.date.getMonth()===t.calenderDefaultDate.getMonth()&&t.calenderDefaultDate.getFullYear()===e.date.getFullYear()?!1:void 0},"delete":function(e){e.preventDefault(),t.recordDelete(e,5)},editable:{destroy:!1},views:["day",{type:"month",selected:!0},"week","agenda","timeline"],allDaySlot:!1,dataSource:{transport:{read:function(a){$.ajax({url:"/api/record/find_custom?locale="+C,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify(Object.assign(t.findRequest,a.data)),success:function(i){if(t.loading=!1,i.total_count<1)return a.success([]),e.globalLoading=!1,!1;var r=f.kendoCaleanderDataProcces(i.data,e.activeView.settings,t.primaryField,t.enddateisAvailable);return a.success(r),e.globalLoading=!1,!0},beforeSend:e.beforeSend()})},update:function(a){var i=a.data,r={id:i.id};r[e.activeView.settings.startdatefield]=i[e.activeView.settings.startdatefield],t.enddateisAvailable&&(r[e.activeView.settings.enddatefield]=i[e.activeView.settings.enddatefield]),f.updateRecord(t.module.name,r).then(function(){a.success(a.data)})}},schema:{model:{id:"id",fields:{id:{type:"number"},start:{type:"date",from:e.activeView.settings.startdatefield},end:{type:"date",from:e.activeView.settings.enddatefield},isAllDay:{type:"boolean"}}}}}},void("end"!==e.activeView.settings.enddatefield&&(e.globalLoading=!1))):!1},t.refreshViewCalendar=function(){t.findRequest={module:t.module.name,take:5e3,filter_logic:e.activeView.filter_logic,filters:e.activeView.filters,convert:!0,fields:[t.primaryField,e.activeView.settings.startdatefield]},t.checkFiltersExistLookupForCalender();$("#viewCalendar").data("kendoScheduler").dataSource.read()},t.checkFiltersExistLookupForCalender=function(){if(Array.isArray(e.activeView.filters)){for(var a=0;a<e.activeView.filters.length;a++){const i=e.activeView.filters[a];i&&i.field.split(".").length>1&&t.findRequest.fields.push(i.field)}t.findRequest.fields=t.findRequest.fields.getUnique()}},t.languageOptions=f.getLanguageOptions(),t.getPicklistValue=function(e,a){if(e&&a){var r=i("filter")(t.module.fields,{name:e},!0)[0];if(r)for(var l=t.modulePicklists[r.picklist_id],o=0;o<l.length;o++){var n=f.getPicklistValue(l[o],a);if(n&&n!==!0)return n}}},t.showFilterModal=function(){const a=i("filter")(e.user.profile.permissions,{type:2},!0)[0];return a?e.activeView&&t.views.length>0&&a.read:e.activeView&&t.views.length>0},e.isDocked&&e.isViewFilterOpen&&V("gt-lg")&&t.filterModalOpen(),t.processViewFilterFirst=function(e){for(var a=0;a<e.filters.length;a++){var i=e.filters[a],r=t.fieldskey[i.field];switch(r&&r.data_type){case"multiselect":case"multiselect_droplist":i.value=i.value&&"-"!=i.value?JSON.parse(i.value):i.value}}}}]);